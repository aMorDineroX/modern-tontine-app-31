var cs=Object.defineProperty;var ds=(t,s,r)=>s in t?cs(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var Q=(t,s,r)=>ds(t,typeof s!="symbol"?s+"":s,r);import{r as c,t as us,c as ms,j as e,V as bt,R as wt,A as vt,C as jt,X as $e,T as Nt,D as kt,a as tt,P as ps,b as xs,d as gs,e as Et,f as fs,S as St,M as Tt,g as hs,_ as it,G as ys,h as bs,i as ot,k as ze,u as ce,L as R,l as Ct,m as ws,n as Ke,o as _e,p as vs,U as Y,q as js,s as At,v as _t,w as Pt,x as Ns,y as ks,z as Dt,I as It,F as Mt,B as Rt,E as Es,H as Ot,J as zt,K as lt,N as Ye,O as Ue,Q as Ss,W as Fe,Y as Ts,Z as Ut,$ as Cs,a0 as As,a1 as Ft,a2 as we,a3 as ve,a4 as je,a5 as et,a6 as Gt,a7 as Pe,a8 as oe,a9 as Lt,aa as Ge,ab as _s,ac as Ps,ad as ct,ae as Ds,af as Is,ag as Ms,ah as Rs,ai as Os,aj as V,ak as zs}from"./vendor-jlci1XVV.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();const Us=1,Fs=1e6;let Xe=0;function Gs(){return Xe=(Xe+1)%Number.MAX_SAFE_INTEGER,Xe.toString()}const Je=new Map,dt=t=>{if(Je.has(t))return;const s=setTimeout(()=>{Je.delete(t),be({type:"REMOVE_TOAST",toastId:t})},Fs);Je.set(t,s)},Ls=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,Us)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(r=>r.id===s.toast.id?{...r,...s.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=s;return r?dt(r):t.toasts.forEach(a=>{dt(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(r=>r.id!==s.toastId)}}},De=[];let Ie={toasts:[]};function be(t){Ie=Ls(Ie,t),De.forEach(s=>{s(Ie)})}function ge({...t}){const s=Gs(),r=n=>be({type:"UPDATE_TOAST",toast:{...n,id:s}}),a=()=>be({type:"DISMISS_TOAST",toastId:s});return be({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||a()}}}),{id:s,dismiss:a,update:r}}function Se(){const[t,s]=c.useState(Ie);return c.useEffect(()=>(De.push(s),()=>{const r=De.indexOf(s);r>-1&&De.splice(r,1)}),[t]),{...t,toast:ge,dismiss:r=>be({type:"DISMISS_TOAST",toastId:r})}}function M(...t){return us(ms(t))}const qs=ps,qt=c.forwardRef(({className:t,...s},r)=>e.jsx(bt,{ref:r,className:M("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));qt.displayName=bt.displayName;const $s=tt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$t=c.forwardRef(({className:t,variant:s,...r},a)=>e.jsx(wt,{ref:a,className:M($s({variant:s}),t),...r}));$t.displayName=wt.displayName;const Vs=c.forwardRef(({className:t,...s},r)=>e.jsx(vt,{ref:r,className:M("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));Vs.displayName=vt.displayName;const Vt=c.forwardRef(({className:t,...s},r)=>e.jsx(jt,{ref:r,className:M("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx($e,{className:"h-4 w-4"})}));Vt.displayName=jt.displayName;const Bt=c.forwardRef(({className:t,...s},r)=>e.jsx(Nt,{ref:r,className:M("text-sm font-semibold",t),...s}));Bt.displayName=Nt.displayName;const Wt=c.forwardRef(({className:t,...s},r)=>e.jsx(kt,{ref:r,className:M("text-sm opacity-90",t),...s}));Wt.displayName=kt.displayName;function Bs(){const{toasts:t}=Se();return e.jsxs(qs,{children:[t.map(function({id:s,title:r,description:a,action:n,...i}){return e.jsxs($t,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(Bt,{children:r}),a&&e.jsx(Wt,{children:a})]}),n,e.jsx(Vt,{})]},s)}),e.jsx(qt,{})]})}const Ws=({...t})=>{const{theme:s="system"}=xs();return e.jsx(gs,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},Hs=fs,Ks=c.forwardRef(({className:t,sideOffset:s=4,...r},a)=>e.jsx(Et,{ref:a,sideOffset:s,className:M("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r}));Ks.displayName=Et.displayName;const Ys={en:{welcome:"Welcome Back!",trackContributions:"Track your tontine contributions and manage your savings groups",createNewGroup:"Create New Group",totalContributions:"Total Contributions",availableBalance:"Available Balance",activeGroups:"Active Groups",nextPayout:"Next Payout",yourGroups:"Your Tontine Groups",viewAll:"View All",paymentCalendar:"Payment Calendar",recentMembers:"Recent Members",recentActivity:"Recent Activity",receivedPayout:"You received a payout of",joinedGroup:"joined",madeContribution:"You made a contribution of",hoursAgo:"hours ago",yesterday:"Yesterday",daysAgo:"days ago",members:"members",contribution:"Contribution",nextDue:"Next Due",active:"Active",pending:"Pending",paid:"Paid",groupName:"Group Name",contributionAmount:"Contribution Amount",contributionFrequency:"Contribution Frequency",startDate:"Start Date",payoutMethod:"Payout Method",inviteMembers:"Invite Members (email addresses, comma separated)",createGroup:"Create Tontine Group",weekly:"Weekly",biweekly:"Bi-weekly",monthly:"Monthly",rotation:"Rotation",randomSelection:"Random Selection",biddingSystem:"Bidding System",dashboard:"Dashboard",myGroups:"My Groups",profile:"Profile",currency:"Currency",language:"Language",settings:"Settings",payments:"Payments",darkMode:"Dark Mode",lightMode:"Light Mode",pageNotFound:"Oops! Page not found",returnToDashboard:"Return to Dashboard"},fr:{welcome:"Bienvenue !",trackContributions:"Suivez vos contributions à la tontine et gérez vos groupes d'épargne",createNewGroup:"Créer un Nouveau Groupe",totalContributions:"Contributions Totales",availableBalance:"Solde Disponible",activeGroups:"Groupes Actifs",nextPayout:"Prochain Versement",yourGroups:"Vos Groupes de Tontine",viewAll:"Voir Tout",paymentCalendar:"Calendrier de Paiement",recentMembers:"Membres Récents",recentActivity:"Activité Récente",receivedPayout:"Vous avez reçu un versement de",joinedGroup:"a rejoint",madeContribution:"Vous avez fait une contribution de",hoursAgo:"heures",yesterday:"Hier",daysAgo:"jours",members:"membres",contribution:"Contribution",nextDue:"Prochaine Échéance",active:"Actif",pending:"En attente",paid:"Payé",groupName:"Nom du Groupe",contributionAmount:"Montant de la Contribution",contributionFrequency:"Fréquence de Contribution",startDate:"Date de Début",payoutMethod:"Méthode de Versement",inviteMembers:"Inviter des Membres (adresses e-mail, séparées par des virgules)",createGroup:"Créer un Groupe de Tontine",weekly:"Hebdomadaire",biweekly:"Bimensuel",monthly:"Mensuel",rotation:"Rotation",randomSelection:"Sélection Aléatoire",biddingSystem:"Système d'Enchères",dashboard:"Tableau de Bord",myGroups:"Mes Groupes",profile:"Profil",currency:"Devise",language:"Langue",settings:"Paramètres",payments:"Paiements",darkMode:"Mode Sombre",lightMode:"Mode Clair",pageNotFound:"Oups ! Page non trouvée",returnToDashboard:"Retourner au Tableau de Bord"},es:{welcome:"¡Bienvenido de Nuevo!",trackContributions:"Sigue tus contribuciones a la tontina y administra tus grupos de ahorro",createNewGroup:"Crear Nuevo Grupo",totalContributions:"Contribuciones Totales",availableBalance:"Saldo Disponible",activeGroups:"Grupos Activos",nextPayout:"Próximo Pago",yourGroups:"Tus Grupos de Tontina",viewAll:"Ver Todo",paymentCalendar:"Calendario de Pagos",recentMembers:"Miembros Recientes",recentActivity:"Actividad Reciente",receivedPayout:"Recibiste un pago de",joinedGroup:"se unió a",madeContribution:"Hiciste una contribución de",hoursAgo:"horas atrás",yesterday:"Ayer",daysAgo:"días atrás",members:"miembros",contribution:"Contribución",nextDue:"Próximo Vencimiento",active:"Activo",pending:"Pendiente",paid:"Pagado",groupName:"Nombre del Grupo",contributionAmount:"Monto de Contribución",contributionFrequency:"Frecuencia de Contribución",startDate:"Fecha de Inicio",payoutMethod:"Método de Pago",inviteMembers:"Invitar Miembros (direcciones de correo, separadas por comas)",createGroup:"Crear Grupo de Tontina",weekly:"Semanal",biweekly:"Quincenal",monthly:"Mensual",rotation:"Rotación",randomSelection:"Selección Aleatoria",biddingSystem:"Sistema de Pujas",dashboard:"Panel",myGroups:"Mis Grupos",profile:"Perfil",currency:"Moneda",language:"Idioma",settings:"Ajustes",payments:"Pagos",darkMode:"Modo Oscuro",lightMode:"Modo Claro",pageNotFound:"¡Ups! Página no encontrada",returnToDashboard:"Volver al Panel"},ar:{welcome:"مرحبًا بعودتك!",trackContributions:"تتبع مساهماتك في التونتين وإدارة مجموعات التوفير الخاصة بك",createNewGroup:"إنشاء مجموعة جديدة",totalContributions:"إجمالي المساهمات",availableBalance:"الرصيد المتاح",activeGroups:"المجموعات النشطة",nextPayout:"الدفعة التالية",yourGroups:"مجموعات التونتين الخاصة بك",viewAll:"عرض الكل",paymentCalendar:"تقويم الدفع",recentMembers:"الأعضاء الأخيرون",recentActivity:"النشاط الأخير",receivedPayout:"لقد تلقيت دفعة بقيمة",joinedGroup:"انضم إلى",madeContribution:"قمت بمساهمة بقيمة",hoursAgo:"ساعات مضت",yesterday:"الأمس",daysAgo:"أيام مضت",members:"الأعضاء",contribution:"المساهمة",nextDue:"الاستحقاق التالي",active:"نشط",pending:"قيد الانتظار",paid:"مدفوع",groupName:"اسم المجموعة",contributionAmount:"مبلغ المساهمة",contributionFrequency:"تكرار المساهمة",startDate:"تاريخ البدء",payoutMethod:"طريقة الدفع",inviteMembers:"دعوة أعضاء (عناوين البريد الإلكتروني، مفصولة بفواصل)",createGroup:"إنشاء مجموعة تونتين",weekly:"أسبوعي",biweekly:"نصف شهري",monthly:"شهري",rotation:"تناوب",randomSelection:"اختيار عشوائي",biddingSystem:"نظام المزايدة",dashboard:"لوحة التحكم",myGroups:"مجموعاتي",profile:"الملف الشخصي",currency:"العملة",language:"اللغة",settings:"الإعدادات",payments:"المدفوعات",darkMode:"الوضع الداكن",lightMode:"الوضع الفاتح",pageNotFound:"عذراً! الصفحة غير موجودة",returnToDashboard:"العودة إلى لوحة التحكم"},sw:{welcome:"Karibu Tena!",trackContributions:"Fuatilia michango yako ya tontine na usimamie vikundi vyako vya akiba",createNewGroup:"Unda Kikundi Kipya",totalContributions:"Michango Yote",availableBalance:"Salio Linalotumika",activeGroups:"Vikundi Vinavyofanya Kazi",nextPayout:"Malipo Yajayo",yourGroups:"Vikundi Vyako vya Tontine",viewAll:"Tazama Vyote",paymentCalendar:"Kalenda ya Malipo",recentMembers:"Wanachama wa Hivi Karibuni",recentActivity:"Shughuli za Hivi Karibuni",receivedPayout:"Umepokea malipo ya",joinedGroup:"alijiunga na",madeContribution:"Umetoa mchango wa",hoursAgo:"saa zilizopita",yesterday:"Jana",daysAgo:"siku zilizopita",members:"wanachama",contribution:"Mchango",nextDue:"Inayofuata",active:"Inayofanya Kazi",pending:"Inasubiri",paid:"Imelipwa",groupName:"Jina la Kikundi",contributionAmount:"Kiasi cha Mchango",contributionFrequency:"Mara ya Mchango",startDate:"Tarehe ya Kuanza",payoutMethod:"Njia ya Malipo",inviteMembers:"Alika Wanachama (barua pepe, zitenganishwe kwa koma)",createGroup:"Unda Kikundi cha Tontine",weekly:"Kila Wiki",biweekly:"Kila Wiki Mbili",monthly:"Kila Mwezi",rotation:"Mzunguko",randomSelection:"Uchaguzi wa Kinasibu",biddingSystem:"Mfumo wa Zabuni",dashboard:"Dashibodi",myGroups:"Vikundi Vyangu",profile:"Wasifu",currency:"Sarafu",language:"Lugha",settings:"Mipangilio",payments:"Malipo",darkMode:"Hali ya Giza",lightMode:"Hali ya Mwanga",pageNotFound:"Samahani! Ukurasa haukupatikana",returnToDashboard:"Rudi kwenye Dashibodi"}},Ht=[{code:"USD",symbol:"$",name:"US Dollar"},{code:"EUR",symbol:"€",name:"Euro"},{code:"XOF",symbol:"CFA",name:"West African CFA Franc"},{code:"XAF",symbol:"FCFA",name:"Central African CFA Franc"},{code:"GHS",symbol:"₵",name:"Ghanaian Cedi"},{code:"NGN",symbol:"₦",name:"Nigerian Naira"},{code:"KES",symbol:"Ksh",name:"Kenyan Shilling"},{code:"ZAR",symbol:"R",name:"South African Rand"},{code:"MAD",symbol:"DH",name:"Moroccan Dirham"},{code:"EGP",symbol:"E£",name:"Egyptian Pound"}],Xs=navigator.language.startsWith("fr")?"fr":navigator.language.startsWith("es")?"es":navigator.language.startsWith("ar")?"ar":navigator.language.startsWith("sw")?"sw":"en",Js=Ht[0],Kt=c.createContext(void 0),Zs=({children:t})=>{const[s,r]=c.useState(()=>localStorage.getItem("language")||Xs),[a,n]=c.useState(()=>{const S=localStorage.getItem("currency");return S?JSON.parse(S):Js}),[i,o]=c.useState(localStorage.getItem("theme")==="dark"||!localStorage.getItem("theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches),g=S=>{r(S),localStorage.setItem("language",S)},u=S=>{n(S),localStorage.setItem("currency",JSON.stringify(S))},y=S=>{o(S);const N=window.document.documentElement;S?(N.classList.add("dark"),localStorage.setItem("theme","dark")):(N.classList.remove("dark"),localStorage.setItem("theme","light"))};c.useEffect(()=>{const S=window.document.documentElement;i?S.classList.add("dark"):S.classList.remove("dark")},[]);const v={language:s,setLanguage:g,t:S=>Ys[s][S],currency:a,setCurrency:u,formatAmount:S=>{const N=typeof S=="string"?parseFloat(S.replace(/[^0-9.-]+/g,"")):S;return isNaN(N)?`${a.symbol}0`:`${a.symbol}${N.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`},isDarkMode:i,setIsDarkMode:y};return e.jsx(Kt.Provider,{value:v,children:t})},L=()=>{const t=c.useContext(Kt);if(t===void 0)throw new Error("useApp must be used within an AppProvider");return t};function ut(){const{isDarkMode:t,setIsDarkMode:s}=L();return e.jsx("button",{onClick:()=>s(!t),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors","aria-label":"Toggle dark mode",children:t?e.jsx(St,{size:20,className:"text-yellow-500"}):e.jsx(Tt,{size:20,className:"text-tontine-dark-purple"})})}function Qs(){return{supabaseUrl:"https://qgpqiehjmkfxfnfrowbc.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFncHFpZWhqbWtmeGZuZnJvd2JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA3MDkzNzUsImV4cCI6MjA1NjI4NTM3NX0.pYcG26WQa-6rIfDcE5mDjNhGbhYAlTMOvCxfYtNmu-0"}}const{supabaseUrl:er,supabaseAnonKey:tr}=Qs(),m=hs(er,tr,{auth:{autoRefreshToken:!0,persistSession:!0,onAuthStateChange:(t,s)=>{console.log("Auth state change:",t),t==="SIGNED_OUT"?(console.log("User signed out"),localStorage.removeItem("signup_attempts")):t==="SIGNED_IN"&&(console.log("User signed in"),localStorage.removeItem("signup_attempts"))}},global:{headers:{"x-client-info":"tontine-app/1.0.0"}},realtime:{params:{eventsPerSecond:10}},db:{schema:"public",onError:t=>{console.error("Supabase Database Error:",{code:t.code,message:t.message,details:t}),t.code==="PGRST116"&&console.warn("Table does not exist. Attempting to create..."),t.message.includes("duplicate key")&&console.warn("Duplicate key error. This might be expected in some scenarios.")}}});async function sr(){try{const t=Date.now(),s=new Promise(async i=>{try{const{data:o,error:g}=await m.auth.getSession();g?(console.warn("Session check failed:",g),i(!1)):i(!0)}catch(o){console.error("Error checking session:",o),i(!1)}}),r=new Promise(async i=>{try{const{data:o,error:g}=await m.from("profiles").select("id").limit(1);g?(console.warn("Profiles table check failed:",g),i(!1)):i(!0)}catch(o){console.error("Error checking profiles table:",o),i(!1)}}),a=await Promise.race([Promise.all([s,r]).then(i=>i.every(o=>o)),new Promise(i=>setTimeout(()=>i(!1),5e3))]),n=Date.now();return console.log(`Supabase availability check took ${n-t}ms`),a}catch(t){return console.error("Comprehensive Supabase availability check failed:",t),!1}}const rr=Object.freeze(Object.defineProperty({__proto__:null,checkSupabaseAvailability:sr,supabase:m},Symbol.toStringTag,{value:"Module"}));async function Ve(t,s={}){return{recordset:[]}}async function ar(){return!1}const nr=Object.freeze(Object.defineProperty({__proto__:null,executeQuery:Ve,isSqlServerAvailable:ar},Symbol.toStringTag,{value:"Module"}));var re=(t=>(t.SUPABASE="supabase",t.SQL_SERVER="sqlserver",t))(re||{});const B={primaryDatabase:"supabase",fallbackDatabase:"sqlserver",useFallback:!0};function mt(t){Object.assign(B,t)}async function pt(t){try{switch(t){case"supabase":const{checkSupabaseAvailability:s}=await it(async()=>{const{checkSupabaseAvailability:a}=await Promise.resolve().then(()=>rr);return{checkSupabaseAvailability:a}},void 0);return await s();case"sqlserver":const{isSqlServerAvailable:r}=await it(async()=>{const{isSqlServerAvailable:a}=await Promise.resolve().then(()=>nr);return{isSqlServerAvailable:a}},void 0);return await r();default:return!1}}catch(s){return console.error(`Error checking ${t} availability:`,s),!1}}async function st(t,s){try{if(B.primaryDatabase==="supabase")return await t();if(B.primaryDatabase==="sqlserver"&&s)return await s()}catch(r){if(console.error(`Error executing query on primary database (${B.primaryDatabase}):`,r),B.useFallback&&B.fallbackDatabase){console.log(`Attempting fallback to ${B.fallbackDatabase}...`);try{if(B.fallbackDatabase==="supabase")return await t();if(B.fallbackDatabase==="sqlserver"&&s)return await s()}catch(a){console.error(`Error executing query on fallback database (${B.fallbackDatabase}):`,a)}}throw r}throw new Error("Invalid database configuration")}async function ir(t){return st(async()=>{try{const{data:s,error:r}=await m.from("profiles").select("*").eq("id",t).single();if(r){if(r.code==="42P01"||r.code==="42501")return console.warn("Profiles table issue:",r.message),{id:t,created_at:new Date().toISOString()};throw r}return s}catch(s){return console.error("Error fetching user profile:",s),{id:t,created_at:new Date().toISOString()}}},async()=>{try{return(await Ve("SELECT * FROM profiles WHERE id = @userId",{userId:t})).recordset[0]||{id:t,created_at:new Date().toISOString()}}catch(s){return console.error("SQL Server error in getUserProfile:",s),{id:t,created_at:new Date().toISOString()}}})}async function or(t){return st(async()=>{if(!t.id)throw new Error("User ID is required");if(!t.email)throw new Error("Email is required");const{data:s,error:r}=await m.from("profiles").select("*").limit(1),a={id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()};if(!r&&s){const n=s[0]||{},i=Object.keys(n);i.includes("avatar_url")&&(a.avatar_url=t.avatar_url||null),i.includes("phone_number")&&(a.phone_number=t.phone_number||null),i.includes("preferred_language")&&(a.preferred_language=t.preferred_language||"en"),i.includes("notification_preferences")&&(a.notification_preferences=t.notification_preferences||{email:!0,push:!0,sms:!1})}else console.warn("Could not determine table schema, using minimal profile data");try{const{error:n}=await m.from("profiles").select("id").limit(1);if(n&&(console.error("Profiles table check error:",n),n.code==="42P01"))return console.warn("Profiles table does not exist. Returning minimal profile."),{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()};const{data:i,error:o}=await m.from("profiles").upsert(a,{onConflict:"id",returning:"minimal"}).select();if(o){if(console.error("Profile creation error details:",{code:o.code,message:o.message,details:o.details,hint:o.hint}),o.code==="PGRST204"&&o.message.includes("column"))return console.warn("Column not found error. Returning minimal profile."),{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()};if(o.code==="23503"||o.code==="42501")return console.warn("Permission or constraint error. Returning minimal profile."),{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()};throw o}return i[0]||{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()}}catch(n){return console.error("Unexpected error in createUserProfile:",{message:n.message,code:n.code,details:n}),{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()}}},async()=>{try{return(await Ve(`MERGE profiles AS target
           USING (VALUES (@id, @email, @fullName, @createdAt, @avatarUrl, @phoneNumber, @language)) 
           AS source (id, email, full_name, created_at, avatar_url, phone_number, preferred_language)
           ON (target.id = source.id)
           WHEN MATCHED THEN 
             UPDATE SET 
               email = source.email,
               full_name = source.full_name,
               avatar_url = source.avatar_url,
               phone_number = source.phone_number,
               preferred_language = source.preferred_language
           WHEN NOT MATCHED THEN 
             INSERT (id, email, full_name, created_at, avatar_url, phone_number, preferred_language)
             VALUES (source.id, source.email, source.full_name, source.created_at, source.avatar_url, source.phone_number, source.preferred_language)
           OUTPUT INSERTED.*;`,{id:t.id,email:t.email,fullName:t.full_name||null,createdAt:t.created_at||new Date().toISOString(),avatarUrl:t.avatar_url||null,phoneNumber:t.phone_number||null,language:t.preferred_language||"en"})).recordset[0]}catch(s){return console.error("SQL Server error in createUserProfile:",s),{id:t.id,email:t.email,full_name:t.full_name||null,created_at:t.created_at||new Date().toISOString()}}})}async function lr(t,s){return st(async()=>{const{data:r,error:a}=await m.from("profiles").select("*").limit(1);if(a)return console.warn("Could not determine table schema for profile update:",a),{id:t,...s};const n={};if(r&&r.length>0){const i=r[0]||{},o=Object.keys(i);Object.keys(s).forEach(g=>{o.includes(g)?n[g]=s[g]:console.warn(`Column '${g}' does not exist in profiles table and will be ignored`)})}else Object.assign(n,s);try{const{data:i,error:o}=await m.from("profiles").update(n).eq("id",t).select();if(o)throw console.error("Profile update error:",o),o;return i[0]||{id:t,...n}}catch(i){if(i.code==="PGRST204"&&i.message.includes("column"))return console.warn("Column not found error during profile update. Returning minimal profile."),{id:t,...n};throw i}},async()=>{const r=Object.keys(s).map(i=>`${i} = @${i}`).join(", "),a={userId:t,...s};return(await Ve(`UPDATE profiles SET ${r} WHERE id = @userId;
         SELECT * FROM profiles WHERE id = @userId`,a)).recordset[0]||{id:t,...s}})}class h extends Error{constructor(r,a,n){super(r);Q(this,"code");Q(this,"details");this.name="AuthServiceError",this.code=a,this.details=n}}const X=(t,s)=>{var a,n,i,o,g,u,y;if((t==null?void 0:t.status)===429)throw new h("Trop de tentatives. Veuillez réessayer plus tard.","429",t);if((a=t==null?void 0:t.message)!=null&&a.includes("network")||(n=t==null?void 0:t.message)!=null&&n.includes("fetch"))throw new h("Erreur de connexion réseau. Veuillez vérifier votre connexion internet.","NETWORK_ERROR",t);if((t==null?void 0:t.status)===500&&((i=t==null?void 0:t.message)!=null&&i.includes("Database error")))throw new h("Erreur de base de données. Veuillez réessayer plus tard.","500",t);if((t==null?void 0:t.status)===400&&((o=t==null?void 0:t.message)!=null&&o.includes("Email already registered")))throw new h("Cette adresse email est déjà utilisée.","400",t);if((t==null?void 0:t.status)===400&&((g=t==null?void 0:t.message)!=null&&g.includes("Invalid login credentials")||(u=t==null?void 0:t.message)!=null&&u.includes("Invalid email or password")))throw new h("Identifiants invalides","400",t);const r=s||(t==null?void 0:t.message)||"Une erreur d'authentification est survenue";throw new h(r,(y=t==null?void 0:t.status)==null?void 0:y.toString(),t)},Le=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),qe=t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(t),cr=async t=>{var s,r;try{if(!Le(t.email))throw new h("Adresse email invalide");if(!qe(t.password))throw new h("Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre");if(console.log("Attempting signup with email:",t.email.replace(/(.{2}).*(@.*)/,"$1***$2")),!Le(t.email))throw new h("Adresse email invalide");if(!qe(t.password))throw new h("Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre");console.log("Attempting signup with email:",t.email.replace(/(.{2}).*(@.*)/,"$1***$2"));const a=`signup_attempt_${t.email}`,n=parseInt(localStorage.getItem(a)||"0",10);if(n>=3)throw new h("Trop de tentatives d'inscription. Veuillez attendre quelques minutes avant de réessayer.","TOO_MANY_ATTEMPTS");localStorage.setItem(a,(n+1).toString()),setTimeout(()=>{localStorage.removeItem(a)},5*60*1e3);const{data:i,error:o}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(i.user&&localStorage.removeItem(a),o)throw console.error("Signup Error Details:",{code:o.code,message:o.message,status:o.status}),o.status===429?new h("Trop de tentatives d'inscription. Le service est temporairement limité. Veuillez réessayer dans quelques minutes.","429_RATE_LIMIT",o):o.message.includes("already in use")||o.message.includes("email already registered")?new h("Cette adresse email est déjà utilisée. Voulez-vous vous connecter ?","EMAIL_IN_USE",o):o.message.includes("network")||o.message.includes("fetch")||o.status===500?new h("Erreur de connexion. Veuillez vérifier votre connexion internet et réessayer.","NETWORK_ERROR",o):new h("Une erreur inattendue est survenue lors de l'inscription. Veuillez réessayer.","UNEXPECTED_ERROR",o);return{user:i.user,session:i.session};if(o){if(console.error("Signup Error Details:",{code:o.code,message:o.message,status:o.status}),o.status===429)throw new h("Trop de tentatives d'inscription. Veuillez réessayer dans quelques minutes.","429",o);if(o.message.includes("already in use")||o.message.includes("email already registered"))throw new h("Cette adresse email est déjà utilisée.","EMAIL_IN_USE",o);if(o.code==="PGRST116"||o.code==="42P01"||o.message.includes("Database error")||o.message.includes("table does not exist")){console.warn("Signup failed due to database issue. Attempting to create profiles table...");try{await m.from("profiles").insert([{id:((s=i==null?void 0:i.user)==null?void 0:s.id)||"00000000-0000-0000-0000-000000000000",email:t.email,full_name:t.fullName||"New User"}]),await m.from("profiles").delete().eq("id","00000000-0000-0000-0000-000000000000");const{data:u,error:y}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(y)throw console.error("Signup failed after table creation attempt:",y),y;return{user:u.user,session:u.session}}catch(u){throw console.error("Critical error during signup table creation:",u),new h("Erreur critique lors de l'inscription. Impossible de créer le profil utilisateur.","DATABASE_SETUP_FAILED",u)}}throw new h("Une erreur inattendue est survenue lors de l'inscription.","UNEXPECTED_ERROR",o)}if(o){if(o.code==="PGRST116"||o.code==="42P01"||o.message.includes("Database error")||o.message.includes("table does not exist")){console.warn("Signup failed due to database issue. Attempting to create profiles table...");try{await m.from("profiles").insert([{id:"00000000-0000-0000-0000-000000000000",email:t.email,full_name:t.fullName||"New User"}]),await m.from("profiles").delete().eq("id","00000000-0000-0000-0000-000000000000");const{data:u,error:y}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(y)throw console.error("Signup failed after table creation attempt:",y),y;return{user:u.user,session:u.session}}catch(u){throw console.error("Critical error during signup table creation:",u),new h("Erreur critique lors de l'inscription. Impossible de créer le profil utilisateur.","DATABASE_SETUP_FAILED",u)}}throw o.status===429?new h("Trop de tentatives d'inscription. Veuillez réessayer dans quelques minutes.","429",o):o.message.includes("already in use")?new h("Cette adresse email est déjà utilisée.","EMAIL_IN_USE",o):o}if(o){if(o.code==="PGRST116"||o.code==="42P01"||o.message.includes("Database error")||o.message.includes("table does not exist")){console.warn("Signup failed due to database issue. Attempting to create profiles table...");try{const{error:u}=await m.rpc("create_profiles_table",{});if(u){console.error("Failed to create profiles table:",u);try{await m.from("profiles").insert([{id:"00000000-0000-0000-0000-000000000000",email:"dummy@example.com",full_name:"Dummy User"}])}catch(j){console.error("Failed to insert dummy record:",j)}}const{data:y,error:p}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(p)throw console.error("Signup failed after table creation attempt:",p),p;return{user:y.user,session:y.session}}catch(u){throw console.error("Critical error during signup table creation:",u),new h("Erreur critique lors de l'inscription. Impossible de créer le profil utilisateur.","DATABASE_SETUP_FAILED",u)}}throw o}if(o){if(o.code==="PGRST116"||o.code==="42P01"||o.message.includes("Database error")||o.message.includes("table does not exist")){console.warn("Signup failed due to database issue. Attempting to create profiles table...");try{const{error:u}=await m.from("profiles").insert([{id:((r=i==null?void 0:i.user)==null?void 0:r.id)||"00000000-0000-0000-0000-000000000000",email:t.email,full_name:t.fullName||"",created_at:new Date().toISOString()}]);if(u)throw console.error("Failed to create profiles table:",u),u;const{data:y,error:p}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(p)throw console.error("Signup failed after table creation:",p),p;return{user:y.user,session:y.session}}catch(u){throw console.error("Critical error during signup table creation:",u),new h("Erreur critique lors de l'inscription. Impossible de créer le profil utilisateur.","DATABASE_SETUP_FAILED",u)}}throw o}if(o&&(o.message.includes("Database error")||o.message.includes("table does not exist")||o.code==="42P01")){console.warn("Signup failed due to database issue. Attempting to create profiles table...");try{const{error:g}=await m.query(`
          CREATE TABLE IF NOT EXISTS public.profiles (
            id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
            email TEXT NOT NULL,
            full_name TEXT,
            avatar_url TEXT,
            phone_number TEXT,
            preferred_language TEXT DEFAULT 'fr',
            notification_preferences JSONB DEFAULT '{"email": true, "push": true, "sms": false}'::jsonb,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
          );
          
          -- Set up Row Level Security (RLS)
          ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
          
          -- Create policies
          CREATE POLICY IF NOT EXISTS "Users can view their own profile"
            ON public.profiles
            FOR SELECT
            USING (auth.uid() = id);
          
          CREATE POLICY IF NOT EXISTS "Users can update their own profile"
            ON public.profiles
            FOR UPDATE
            USING (auth.uid() = id);
          
          CREATE POLICY IF NOT EXISTS "Users can insert their own profile"
            ON public.profiles
            FOR INSERT
            WITH CHECK (auth.uid() = id);
        `);if(g)throw console.error("Failed to create profiles table:",g),g;const{data:u,error:y}=await m.auth.signUp({email:t.email,password:t.password,options:{data:{full_name:t.fullName}}});if(y)throw console.error("Signup failed after table creation:",y),y;return{user:u.user,session:u.session}}catch(g){throw console.error("Critical error during signup table creation:",g),new h("Erreur critique lors de l'inscription. Impossible de créer le profil utilisateur.","DATABASE_SETUP_FAILED",g)}}if(i.user)try{const{error:g}=await m.rpc("create_profiles_table",{});if(g){console.warn("Failed to create profiles table via RPC:",g);try{await m.query(`
              CREATE TABLE IF NOT EXISTS public.profiles (
                id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
                email TEXT NOT NULL,
                full_name TEXT,
                avatar_url TEXT,
                phone_number TEXT,
                preferred_language TEXT DEFAULT 'fr',
                notification_preferences JSONB DEFAULT '{"email": true, "push": true, "sms": false}'::jsonb,
                created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
              );
              
              -- Set up Row Level Security (RLS)
              ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
              
              -- Create policies
              CREATE POLICY IF NOT EXISTS "Users can view their own profile"
                ON public.profiles
                FOR SELECT
                USING (auth.uid() = id);
              
              CREATE POLICY IF NOT EXISTS "Users can update their own profile"
                ON public.profiles
                FOR UPDATE
                USING (auth.uid() = id);
              
              CREATE POLICY IF NOT EXISTS "Users can insert their own profile"
                ON public.profiles
                FOR INSERT
                WITH CHECK (auth.uid() = id);
            `)}catch(y){console.error("Failed to create profiles table via direct query:",y)}}return{user:await or({id:i.user.id,email:t.email,full_name:t.fullName,created_at:new Date().toISOString()}),session:i.session}}catch(g){console.error("Error creating user profile:",{message:g.message,details:g});try{const{data:u,error:y}=await m.from("profiles").upsert({id:i.user.id,email:t.email,full_name:t.fullName,created_at:new Date().toISOString()},{onConflict:"id"});return y?(console.error("Direct profile insert failed:",y),{user:{id:i.user.id,email:t.email,full_name:t.fullName,created_at:new Date().toISOString()},session:i.session,error:"Profile creation failed. Some features may be limited."}):{user:u[0]||{id:i.user.id,email:t.email,full_name:t.fullName,created_at:new Date().toISOString()},session:i.session}}catch(u){return console.error("Comprehensive profile insert error:",u),{user:{id:i.user.id,email:t.email,full_name:t.fullName,created_at:new Date().toISOString()},session:i.session,error:"Profile creation failed. Some features may be limited."}}}}catch(a){if(console.error("Final Signup Error:",{name:a.name,message:a.message,stack:a.stack,details:a}),a instanceof h)throw a;const n=a instanceof Error?a.message:"Erreur inconnue lors de l'inscription";throw new h(n,void 0,a)}},dr=async t=>{try{if(!t.email||!t.password)throw new h("Email et mot de passe requis","400");const{data:s,error:r}=await m.auth.signInWithPassword({email:t.email,password:t.password});if(r){if(r.status===429)throw console.warn("Rate limiting detected during login. Consider implementing a retry mechanism."),new h("Trop de tentatives de connexion. Veuillez réessayer plus tard.","429",r);if(r.status===400&&(r.message.includes("Invalid login credentials")||r.message.includes("Invalid email or password")||r.message.includes("Email not confirmed")))throw new h("Identifiants invalides","400",r);X(r,"Identifiants invalides")}let a=null;if(s.user)try{const{data:n,error:i}=await m.from("profiles").select("*").eq("id",s.user.id).single();i?console.warn("Could not fetch user profile after login:",i):a=n}catch(n){console.warn("Error fetching profile after login:",n)}return{user:a||(s.user?{id:s.user.id,email:s.user.email||t.email,created_at:s.user.created_at||new Date().toISOString()}:null),session:s.session}}catch(s){throw s instanceof h?s:new h("Erreur lors de la connexion",void 0,s)}},ur=async t=>{try{const{error:s}=await m.auth.signInWithOAuth({provider:t,options:{redirectTo:`${window.location.origin}/auth/callback`}});s&&X(s,`Erreur lors de la connexion avec ${t}`)}catch(s){throw s instanceof h?s:new h(`Erreur lors de la connexion avec ${t}`,void 0,s)}},mr=async()=>{try{const{error:t}=await m.auth.signOut();t&&X(t,"Erreur lors de la déconnexion")}catch(t){throw t instanceof h?t:new h("Erreur lors de la déconnexion",void 0,t)}},pr=async()=>{try{const{data:t,error:s}=await m.auth.getSession();return s&&X(s,"Erreur lors de la récupération de la session"),t.session}catch(t){throw t instanceof h?t:new h("Erreur lors de la récupération de la session",void 0,t)}},xr=async()=>{try{const{data:t,error:s}=await m.auth.getUser();if(s&&X(s,"Erreur lors de la récupération de l'utilisateur"),!t.user)return null;try{const r=await ir(t.user.id);if(r)return r;console.warn("User profile not found for user:",t.user.id);const a=t.user.user_metadata||{};return{id:t.user.id,email:t.user.email||"",full_name:a.full_name||"",created_at:t.user.created_at||new Date().toISOString()}}catch(r){return console.error("Error fetching user profile:",r),{id:t.user.id,email:t.user.email||"",created_at:t.user.created_at||new Date().toISOString()}}}catch(t){throw t instanceof h?t:new h("Erreur lors de la récupération de l'utilisateur",void 0,t)}},gr=async t=>{try{if(!Le(t))throw new h("Adresse email invalide");const{error:s}=await m.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/reset-password`});s&&X(s,"Erreur lors de la demande de réinitialisation")}catch(s){throw s instanceof h?s:new h("Erreur lors de la demande de réinitialisation",void 0,s)}},fr=async t=>{try{if(!qe(t))throw new h("Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre");const{error:s}=await m.auth.updateUser({password:t});s&&X(s,"Erreur lors de la mise à jour du mot de passe")}catch(s){throw s instanceof h?s:new h("Erreur lors de la mise à jour du mot de passe",void 0,s)}},hr=async(t,s)=>{try{const r={},{data:a,error:n}=await m.from("profiles").select("*").limit(1);if(n)throw console.warn("Could not determine table schema for profile update:",n),new h("Erreur lors de la mise à jour du profil",n.code,n);if(a&&a.length>0){const i=a[0]||{},o=Object.keys(i);s.fullName!==void 0&&o.includes("full_name")&&(r.full_name=s.fullName),s.avatarUrl!==void 0&&o.includes("avatar_url")&&(r.avatar_url=s.avatarUrl),s.phoneNumber!==void 0&&o.includes("phone_number")&&(r.phone_number=s.phoneNumber),s.preferredLanguage!==void 0&&o.includes("preferred_language")&&(r.preferred_language=s.preferredLanguage),s.notificationPreferences!==void 0&&o.includes("notification_preferences")&&(r.notification_preferences=s.notificationPreferences)}else s.fullName!==void 0&&(r.full_name=s.fullName);try{return await lr(t,r)}catch(i){throw console.error("Error updating user profile:",i),new h("Erreur lors de la mise à jour du profil",void 0,i)}}catch(r){throw r instanceof h?r:new h("Erreur lors de la mise à jour du profil",void 0,r)}},yr=async(t,s)=>{try{const r=s.name.split(".").pop(),n=`avatars/${`${t}-${Math.random().toString(36).substring(2)}.${r}`}`,{error:i}=await m.storage.from("user-content").upload(n,s);if(i)throw i.message.includes("not found")||i.message.includes("does not exist")?new h("Le stockage d'avatars n'est pas configuré. Veuillez contacter l'administrateur.","STORAGE_NOT_FOUND",i):new h("Erreur lors du téléchargement de l'avatar",i.message,i);const{data:o}=m.storage.from("user-content").getPublicUrl(n),{data:g,error:u}=await m.from("profiles").select("*").limit(1);if(u)return console.warn("Could not determine table schema for avatar update:",u),o.publicUrl;const y=g[0]||{};if(Object.keys(y).includes("avatar_url")){const{error:j}=await m.from("profiles").update({avatar_url:o.publicUrl}).eq("id",t);j&&console.warn("Could not update profile with avatar URL:",j)}else console.warn("avatar_url column does not exist in profiles table");return o.publicUrl}catch(r){throw r instanceof h?r:new h("Erreur lors du téléchargement de l'avatar",void 0,r)}},br=async()=>{try{const{data:t}=await m.auth.getSession();return!!t.session}catch(t){return console.error("Erreur lors de la vérification de l'authentification:",t),!1}},G={signup:cr,login:dr,loginWithProvider:ur,logout:mr,getCurrentSession:pr,getCurrentUser:xr,resetPassword:gr,updatePassword:fr,updateProfile:hr,uploadAvatar:yr,isAuthenticated:br,isValidEmail:Le,isStrongPassword:qe};async function xt(t,s=3,r=1e3,a=Me){let n;for(let i=0;i<=s;i++)try{return await t()}catch(o){if(n=o,i>=s||!a(o))throw o;const g=wr(i,r);console.log(`Retry attempt ${i+1}/${s} after ${g}ms`),await vr(g)}throw n}function wr(t,s){const r=s*Math.pow(2,t),a=Math.random();return Math.min(r*(1+a),3e4)}function vr(t){return new Promise(s=>setTimeout(s,t))}function Me(t){return!!((t==null?void 0:t.status)===429||t!=null&&t.message&&(t.message.includes("network")||t.message.includes("connection")||t.message.includes("timeout")||t.message.includes("fetch"))||t!=null&&t.status&&t.status>=500&&t.status<600||t!=null&&t.message&&(t.message.includes("Database error")||t.message.includes("base de données")))}function Ze(t,s=5,r=6e4){const a=`rateLimit_${t}`,n=Date.now();try{const i=localStorage.getItem(a);let o=i?JSON.parse(i):[];return o=o.filter(g=>n-g<r),o.length>=s?!1:(o.push(n),localStorage.setItem(a,JSON.stringify(o)),!0)}catch(i){return console.warn("Error in rate limit check:",i),!0}}const Yt=c.createContext({user:null,session:null,isLoading:!0,isAuthenticated:!1,login:async()=>!1,loginWithProvider:async()=>{},signup:async()=>!1,logout:async()=>{},resetPassword:async()=>{},updatePassword:async()=>{},updateProfile:async()=>({id:"",email:"",created_at:""}),uploadAvatar:async()=>"",refreshUser:async()=>{},refreshSession:async()=>!1}),J=()=>c.useContext(Yt),jr=({children:t})=>{const[s,r]=c.useState(null),[a,n]=c.useState(null),[i,o]=c.useState(!0),g=async()=>{try{const d=await G.getCurrentSession();if(d){n(d);const f=await G.getCurrentUser();return r(f),!0}return n(null),r(null),!1}catch(d){return console.error("Erreur lors du rafraîchissement de la session:",d),n(null),r(null),!1}};c.useEffect(()=>{(async()=>{o(!0);try{const P=await G.getCurrentSession();if(n(P),P){const T=await G.getCurrentUser();r(T)}}catch(P){console.error("Erreur lors de l'initialisation de l'authentification:",P)}finally{o(!1)}})();const{data:{subscription:f}}=m.auth.onAuthStateChange(async(P,T)=>{if(n(T),P==="SIGNED_IN"||P==="TOKEN_REFRESHED"){const k=await G.getCurrentUser();r(k)}else P==="SIGNED_OUT"&&r(null)});return()=>{f.unsubscribe()}},[]);const D={user:s,session:a,isLoading:i,isAuthenticated:!!a,login:async(d,f)=>{if(o(!0),!Ze("login",5,6e4))throw new h("Trop de tentatives de connexion. Veuillez réessayer plus tard.","429");try{const P=await xt(async()=>{const T=await G.login({email:d,password:f});if(T.error)throw new Error(T.error);return T},2,1e3,T=>Me(T)&&!(T.message&&(T.message.includes("Invalid credentials")||T.message.includes("Identifiants invalides"))));return n(P.session),r(P.user),!0}catch(P){throw console.error("Erreur de connexion:",P),P}finally{o(!1)}},loginWithProvider:async d=>{try{await G.loginWithProvider(d)}catch(f){throw console.error(`Erreur de connexion avec ${d}:`,f),f}},signup:async(d,f,P)=>{if(o(!0),!Ze("signup",3,36e5))throw new h("Trop de tentatives d'inscription. Veuillez réessayer plus tard.","429");try{const T=await xt(async()=>{try{const k=await G.signup({email:d,password:f,fullName:P});return console.log("Signup response in context:",{user:k.user?{id:k.user.id,email:k.user.email}:null,session:k.session?"Session exists":"No session",error:k.error}),k.error&&console.warn("Signup completed with warning:",k.error),k}catch(k){throw console.error("Signup attempt error:",{name:k.name,message:k.message,details:k}),k.message&&(k.message.includes("email invalide")||k.message.includes("mot de passe")||k.message.includes("déjà utilisée"))?k:k.message&&(k.message.includes("base de données")||k.message.includes("Database error"))?(console.warn("Database error during signup, will retry:",k.message),k):(Me(k)&&console.warn("Retryable error during signup:",k.message),k)}},2,2e3,k=>Me(k)||k.message&&(k.message.includes("base de données")||k.message.includes("Database error")));return n(T.session),r(T.user),!0}catch(T){throw console.error("Comprehensive Signup Error:",{name:T.name,message:T.message,details:T}),T.message&&(T.message.includes("base de données")||T.message.includes("Database error"))?new h("Erreur temporaire du serveur. Veuillez réessayer dans quelques instants.",T.code,T):T}finally{o(!1)}},logout:async()=>{o(!0);try{await G.logout(),r(null),n(null)}catch(d){throw console.error("Erreur de déconnexion:",d),d}finally{o(!1)}},resetPassword:async d=>{if(!Ze("resetPassword",2,36e5))throw new h("Trop de tentatives de réinitialisation. Veuillez réessayer plus tard.","429");try{await G.resetPassword(d)}catch(f){throw console.error("Erreur de réinitialisation de mot de passe:",f),f}},updatePassword:async d=>{try{await G.updatePassword(d)}catch(f){throw console.error("Erreur de mise à jour de mot de passe:",f),f}},updateProfile:async d=>{try{if(!s)throw new Error("Utilisateur non authentifié");const f=await G.updateProfile(s.id,{fullName:d.fullName,avatarUrl:d.avatarUrl,phoneNumber:d.phoneNumber,preferredLanguage:d.preferredLanguage,notificationPreferences:d.notificationPreferences});return r(f),f}catch(f){throw console.error("Erreur de mise à jour du profil:",f),f}},uploadAvatar:async d=>{try{if(!s)throw new Error("Utilisateur non authentifié");const f=await G.uploadAvatar(s.id,d);return r(P=>P?{...P,avatar_url:f}:null),f}catch(f){throw console.error("Erreur de téléchargement d'avatar:",f),f}},refreshUser:async()=>{try{if(!a){r(null);return}const d=await G.getCurrentUser();r(d)}catch(d){throw console.error("Erreur lors du rafraîchissement des données utilisateur:",d),d}},refreshSession:g};return e.jsx(Yt.Provider,{value:D,children:t})};function gt({type:t}){var j;const{language:s,setLanguage:r,currency:a,setCurrency:n,t:i}=L(),[o,g]=c.useState(!1),u=[{value:"en",label:"English"},{value:"fr",label:"Français"},{value:"es",label:"Español"},{value:"ar",label:"العربية"},{value:"sw",label:"Kiswahili"}],y=v=>{r(v),g(!1)},p=v=>{n(v),g(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>g(!o),className:"flex items-center justify-between w-full p-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-left text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ys,{size:16,className:"mr-2 text-gray-500 dark:text-gray-400"}),t==="language"?(j=u.find(v=>v.value===s))==null?void 0:j.label:`${a.code} (${a.symbol})`]}),e.jsx(bs,{size:16,className:"text-gray-500 dark:text-gray-400"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>g(!1)}),e.jsx("div",{className:"absolute z-20 mt-1 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 py-1 shadow-lg",children:t==="language"?e.jsx("div",{className:"max-h-56 overflow-y-auto",children:u.map(v=>e.jsxs("button",{className:`flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 ${s===v.value?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>y(v.value),children:[s===v.value&&e.jsx(ot,{size:14,className:"mr-2 text-tontine-purple"}),e.jsx("span",{className:s===v.value?"ml-5":"ml-7",children:v.label})]},v.value))}):e.jsx("div",{className:"max-h-56 overflow-y-auto",children:Ht.map(v=>e.jsxs("button",{className:`flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 ${a.code===v.code?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>p(v),children:[a.code===v.code&&e.jsx(ot,{size:14,className:"mr-2 text-tontine-purple"}),e.jsxs("span",{className:a.code===v.code?"ml-5":"ml-7",children:[v.code," (",v.symbol,") - ",v.name]})]},v.code))})})]})]})}function Nr({isOpen:t,onClose:s}){const{t:r,isDarkMode:a,setIsDarkMode:n}=L();return c.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-30",onClick:s}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-40 p-4 pointer-events-none",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md pointer-events-auto animate-fade-in",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ze,{className:"w-5 h-5 mr-2 text-tontine-purple dark:text-tontine-light-purple"}),e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:r("settings")})]}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx($e,{size:20})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("language")}),e.jsx(gt,{type:"language"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("currency")}),e.jsx(gt,{type:"currency"})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:r(a?"darkMode":"lightMode")}),e.jsx("button",{onClick:()=>n(!a),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":"Toggle dark mode",children:a?e.jsx(St,{size:20,className:"text-yellow-500"}):e.jsx(Tt,{size:20,className:"text-tontine-dark-purple"})})]})})]})]})})})]}):null}function Be(){const[t,s]=c.useState(!1),[r,a]=c.useState(!1),[n,i]=c.useState(!1),{t:o}=L(),{signOut:g}=J(),u=ce(),y=async()=>{await g(),u("/")};return e.jsxs("nav",{className:"relative z-20 bg-white dark:bg-gray-900 shadow-sm",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(R,{to:"/",className:"flex-shrink-0 flex items-center",children:e.jsx("span",{className:"text-2xl font-bold tontine-text-gradient",children:"Tontine"})})}),e.jsxs("div",{className:"hidden sm:ml-6 sm:flex sm:items-center sm:space-x-8",children:[e.jsx(R,{to:"/dashboard",className:"px-3 py-2 text-sm font-medium text-gray-900 dark:text-gray-100 hover:text-tontine-purple dark:hover:text-tontine-light-purple transition-colors",children:o("dashboard")}),e.jsx(R,{to:"/groups",className:"px-3 py-2 text-sm font-medium text-gray-900 dark:text-gray-100 hover:text-tontine-purple dark:hover:text-tontine-light-purple transition-colors",children:o("myGroups")}),e.jsx(R,{to:"/profile",className:"px-3 py-2 text-sm font-medium text-gray-900 dark:text-gray-100 hover:text-tontine-purple dark:hover:text-tontine-light-purple transition-colors",children:o("profile")}),e.jsx("button",{onClick:()=>a(!0),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:e.jsx(ze,{size:20,className:"text-tontine-dark-purple dark:text-tontine-light-purple"})}),e.jsx(ut,{}),e.jsx("button",{className:"tontine-button tontine-button-primary",onClick:()=>i(!0),children:o("createNewGroup")}),e.jsx("button",{onClick:y,className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors flex items-center gap-2 text-gray-700 dark:text-gray-300",title:"Sign out",children:e.jsx(Ct,{size:20})})]}),e.jsxs("div",{className:"flex items-center sm:hidden",children:[e.jsx("button",{onClick:()=>a(!0),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors mr-2",children:e.jsx(ze,{size:20,className:"text-tontine-dark-purple dark:text-tontine-light-purple"})}),e.jsx(ut,{}),e.jsxs("button",{onClick:()=>s(!t),className:"ml-2 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-tontine-purple",children:[e.jsx("span",{className:"sr-only",children:"Open main menu"}),t?e.jsx($e,{className:"block h-6 w-6"}):e.jsx(ws,{className:"block h-6 w-6"})]})]})]})}),t&&e.jsx("div",{className:"sm:hidden absolute w-full bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 animate-slide-down",children:e.jsxs("div",{className:"pt-2 pb-3 space-y-1",children:[e.jsx(R,{to:"/dashboard",className:"block px-3 py-2 text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-tontine-purple dark:hover:text-tontine-light-purple",onClick:()=>s(!1),children:o("dashboard")}),e.jsx(R,{to:"/groups",className:"block px-3 py-2 text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-tontine-purple dark:hover:text-tontine-light-purple",onClick:()=>s(!1),children:o("myGroups")}),e.jsx(R,{to:"/profile",className:"block px-3 py-2 text-base font-medium text-gray-900 dark:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-tontine-purple dark:hover:text-tontine-light-purple",onClick:()=>s(!1),children:o("profile")}),e.jsx("div",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>{s(!1),i(!0)},className:"w-full tontine-button tontine-button-primary",children:o("createNewGroup")})}),e.jsx("button",{onClick:()=>{y(),s(!1)},className:"block w-full text-left px-3 py-2 text-base font-medium text-red-600 dark:text-red-400 hover:bg-gray-50 dark:hover:bg-gray-800",children:"Sign Out"})]})}),e.jsx(Nr,{isOpen:r,onClose:()=>a(!1)})]})}function Xt({isOpen:t,onClose:s,onSubmit:r}){const{t:a,currency:n}=L(),[i,o]=c.useState(""),[g,u]=c.useState(""),[y,p]=c.useState("monthly"),[j,v]=c.useState(""),[S,N]=c.useState("rotation"),[U,b]=c.useState("");if(c.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),!t)return null;const D=d=>{d.preventDefault(),r({name:i,contribution:g,frequency:y,members:j}),o(""),u(""),p("monthly"),v(""),N("rotation"),b("")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-30",onClick:s}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-40 p-4 pointer-events-none",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md pointer-events-auto animate-fade-in",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:a("createGroup")}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx($e,{size:20})})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("groupName")}),e.jsx("input",{type:"text",id:"name",value:i,onChange:d=>o(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Family Tontine",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"contribution",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[a("contributionAmount")," (",n.symbol,")"]}),e.jsx("input",{type:"text",id:"contribution",value:g,onChange:d=>u(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"50",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("contributionFrequency")}),e.jsxs("select",{id:"frequency",value:y,onChange:d=>p(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0,children:[e.jsx("option",{value:"weekly",children:a("weekly")}),e.jsx("option",{value:"biweekly",children:a("biweekly")}),e.jsx("option",{value:"monthly",children:a("monthly")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("startDate")}),e.jsx("input",{type:"date",id:"startDate",value:U,onChange:d=>b(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"payoutMethod",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("payoutMethod")}),e.jsxs("select",{id:"payoutMethod",value:S,onChange:d=>N(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"rotation",children:a("rotation")}),e.jsx("option",{value:"random",children:a("randomSelection")}),e.jsx("option",{value:"bidding",children:a("biddingSystem")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"members",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:a("inviteMembers")}),e.jsx("textarea",{id:"members",value:j,onChange:d=>v(d.target.value),className:"tontine-input w-full mt-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:3,placeholder:"email1@example.com, email2@example.com"})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{type:"submit",className:"tontine-button tontine-button-primary w-full",children:a("createGroup")})})]})]})})})]})}const ft=[{id:1,name:"Family Savings",members:8,contribution:50,frequency:"monthly",nextDue:"Jun 15, 2023",description:"Monthly savings for family emergencies and future plans."},{id:2,name:"Friends Circle",members:5,contribution:100,frequency:"monthly",nextDue:"Jun 22, 2023",description:"Collective savings for group travel and shared experiences."},{id:3,name:"Business Collective",members:12,contribution:200,frequency:"monthly",nextDue:"Jul 1, 2023",description:"Investment pool for entrepreneurial opportunities."}],kr=()=>{const[t,s]=c.useState(!1),{t:r,formatAmount:a}=L(),n=i=>{console.log("Creating new group:",i),s(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 animate-fade-in",children:[e.jsx(Be,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:r("myGroups")}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:r("manageAndTrackYourTontineGroups")})]}),e.jsx("div",{className:"mt-4 lg:mt-0",children:e.jsxs("button",{className:"tontine-button tontine-button-primary inline-flex items-center",onClick:()=>s(!0),children:[e.jsx(Ke,{size:18,className:"mr-2"}),r("createNewGroup")]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ft.map(i=>e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold dark:text-white",children:i.name}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",title:"Edit Group",children:e.jsx(_e,{size:18})}),e.jsx("button",{className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-500",title:"Delete Group",children:e.jsx(vs,{size:18})})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:i.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{size:16,className:"mr-2 text-tontine-dark-purple"}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:r("members")})]}),e.jsx("p",{className:"text-lg font-semibold dark:text-white",children:i.members})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{size:16,className:"mr-2 text-green-600"}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:r("contribution")})]}),e.jsxs("p",{className:"text-lg font-semibold dark:text-white",children:[a(i.contribution)," / ",r(i.frequency)]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r("nextDue"),": ",i.nextDue]}),e.jsxs(R,{to:`/groups/${i.id}`,className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple inline-flex items-center",children:[r("viewDetails"),e.jsx(js,{size:16,className:"ml-1"})]})]})]},i.id))}),ft.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-tontine-light-purple/20 text-tontine-dark-purple dark:bg-tontine-purple/20 dark:text-tontine-light-purple p-4 rounded-full inline-flex items-center justify-center mb-4",children:e.jsx(Y,{size:32})}),e.jsx("h3",{className:"text-xl font-semibold mb-2 dark:text-white",children:r("noGroupsYet")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:r("createFirstGroupDescription")}),e.jsxs("button",{className:"tontine-button tontine-button-primary",onClick:()=>s(!0),children:[e.jsx(Ke,{size:18,className:"mr-2"}),r("createFirstGroup")]})]})]}),e.jsx(Xt,{isOpen:t,onClose:()=>s(!1),onSubmit:n})]})},Er=Ns,Jt=c.forwardRef(({className:t,...s},r)=>e.jsx(At,{ref:r,className:M("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Jt.displayName=At.displayName;const fe=c.forwardRef(({className:t,...s},r)=>e.jsx(_t,{ref:r,className:M("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));fe.displayName=_t.displayName;const he=c.forwardRef(({className:t,...s},r)=>e.jsx(Pt,{ref:r,className:M("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));he.displayName=Pt.displayName;const ee=c.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));ee.displayName="Card";const ae=c.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("flex flex-col space-y-1.5 p-6",t),...s}));ae.displayName="CardHeader";const ne=c.forwardRef(({className:t,...s},r)=>e.jsx("h3",{ref:r,className:M("text-2xl font-semibold leading-none tracking-tight",t),...s}));ne.displayName="CardTitle";const ye=c.forwardRef(({className:t,...s},r)=>e.jsx("p",{ref:r,className:M("text-sm text-muted-foreground",t),...s}));ye.displayName="CardDescription";const te=c.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("p-6 pt-0",t),...s}));te.displayName="CardContent";const Sr=c.forwardRef(({className:t,...s},r)=>e.jsx("div",{ref:r,className:M("flex items-center p-6 pt-0",t),...s}));Sr.displayName="CardFooter";const Tr=tt("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),H=c.forwardRef(({className:t,variant:s,size:r,asChild:a=!1,...n},i)=>{const o=a?ks:"button";return e.jsx(o,{className:M(Tr({variant:s,size:r,className:t})),ref:i,...n})});H.displayName="Button";const Zt=c.forwardRef(({className:t,...s},r)=>e.jsx(Dt,{ref:r,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));Zt.displayName=Dt.displayName;const Qt=c.forwardRef(({className:t,...s},r)=>e.jsx(It,{ref:r,className:M("aspect-square h-full w-full",t),...s}));Qt.displayName=It.displayName;const es=c.forwardRef(({className:t,...s},r)=>e.jsx(Mt,{ref:r,className:M("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));es.displayName=Mt.displayName;const Re=c.forwardRef(({className:t,...s},r)=>e.jsx(Rt,{className:M("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:r,children:e.jsx(Es,{className:M("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Re.displayName=Rt.displayName;const Cr=tt("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),K=c.forwardRef(({className:t,...s},r)=>e.jsx(Ot,{ref:r,className:M(Cr(),t),...s}));K.displayName=Ot.displayName;const Oe=c.forwardRef(({className:t,orientation:s="horizontal",decorative:r=!0,...a},n)=>e.jsx(zt,{ref:n,decorative:r,orientation:s,className:M("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));Oe.displayName=zt.displayName;const Ar=()=>{var F,Ce,de,Ae;const{user:t,signOut:s}=J(),{t:r,formatAmount:a}=L(),n=ce(),[i,o]=c.useState(!1),[g,u]=c.useState(((F=t==null?void 0:t.user_metadata)==null?void 0:F.full_name)||"Utilisateur Tontine"),[y]=c.useState((t==null?void 0:t.email)||"utilisateur@exemple.com"),[p,j]=c.useState(((Ce=t==null?void 0:t.user_metadata)==null?void 0:Ce.phone)||"+33 6 12 34 56 78"),[v,S]=c.useState(((de=t==null?void 0:t.user_metadata)==null?void 0:de.birthdate)||"01/01/1980"),[N,U]=c.useState(!0),[b,D]=c.useState(!1),[d,f]=c.useState(!1),[P,T]=c.useState("Français"),k=[{id:1,type:"contribution",amount:100,group:"Family Savings",date:"15 Mai 2023",status:"completed"},{id:2,type:"payout",amount:800,group:"Friends Circle",date:"22 Avril 2023",status:"completed"},{id:3,type:"contribution",amount:50,group:"Family Savings",date:"15 Avril 2023",status:"completed"},{id:4,type:"contribution",amount:200,group:"Business Collective",date:"1 Avril 2023",status:"completed"}],Z=[{id:1,type:"card",last4:"4242",expiry:"04/25",default:!0},{id:2,type:"bank",accountNumber:"****3456",name:"Compte Courant",default:!1}],C=async()=>{await s(),n("/")},E=async()=>{try{o(!1),ge({title:"Profil mis à jour",description:"Vos informations personnelles ont été mises à jour avec succès.",variant:"default"})}catch(A){console.error("Error updating profile:",A),ge({title:"Erreur",description:"Une erreur est survenue lors de la mise à jour de votre profil.",variant:"destructive"})}},q=()=>{ge({title:"Email envoyé",description:"Un email de réinitialisation de mot de passe a été envoyé à votre adresse email.",variant:"default"})},I=()=>{D(!b),ge({title:b?"Authentification à deux facteurs désactivée":"Authentification à deux facteurs activée",description:b?"La sécurité de votre compte est réduite.":"Votre compte est maintenant mieux protégé.",variant:"default"})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 animate-fade-in",children:[e.jsx(Be,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Profil Personnel"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Gérez vos informations personnelles et vos préférences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx(ee,{children:e.jsx(te,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsxs(Zt,{className:"h-24 w-24 mb-4",children:[e.jsx(Qt,{src:(Ae=t==null?void 0:t.user_metadata)==null?void 0:Ae.avatar_url}),e.jsx(es,{className:"bg-tontine-light-purple text-tontine-dark-purple text-xl",children:g.split(" ").map(A=>A[0]).join("").toUpperCase()})]}),e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:g}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:y}),e.jsxs("div",{className:"mt-4 w-full",children:[e.jsxs(H,{variant:"outline",className:"w-full mb-2",onClick:()=>o(!0),children:[e.jsx(_e,{size:16,className:"mr-2"}),"Modifier le profil"]}),e.jsxs(H,{variant:"destructive",className:"w-full",onClick:C,children:[e.jsx(Ct,{size:16,className:"mr-2"}),"Déconnexion"]})]})]})})}),e.jsxs(ee,{className:"mt-4",children:[e.jsx(ae,{children:e.jsx(ne,{children:"Résumé Financier"})}),e.jsx(te,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-3",children:e.jsx(lt,{size:16,className:"text-green-600"})}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Total Épargné"})]}),e.jsx("span",{className:"font-semibold dark:text-white",children:a(3200)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3",children:e.jsx(Ye,{size:16,className:"text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Contributions"})]}),e.jsx("span",{className:"font-semibold dark:text-white",children:a(1250)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-3",children:e.jsx(Ue,{size:16,className:"text-purple-600"})}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Groupes Actifs"})]}),e.jsx("span",{className:"font-semibold dark:text-white",children:"3"})]})]})})]})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(Er,{defaultValue:"personal",className:"w-full",children:[e.jsxs(Jt,{className:"mb-4 grid grid-cols-4",children:[e.jsx(fe,{value:"personal",children:"Informations"}),e.jsx(fe,{value:"security",children:"Sécurité"}),e.jsx(fe,{value:"payments",children:"Paiements"}),e.jsx(fe,{value:"history",children:"Historique"})]}),e.jsx(he,{value:"personal",children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ne,{children:"Informations Personnelles"}),i?e.jsxs(H,{onClick:E,children:[e.jsx(Ss,{size:16,className:"mr-2"}),"Enregistrer"]}):e.jsxs(H,{variant:"outline",size:"sm",onClick:()=>o(!0),children:[e.jsx(_e,{size:16,className:"mr-2"}),"Modifier"]})]}),e.jsx(ye,{children:"Gérez vos informations personnelles"})]}),e.jsx(te,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"fullName",children:"Nom complet"}),i?e.jsx("input",{id:"fullName",type:"text",value:g,onChange:A=>u(A.target.value),className:"tontine-input w-full",placeholder:"Nom complet"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{size:16,className:"text-gray-500 mr-2"}),e.jsx("p",{className:"text-base dark:text-white",children:g})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"email",children:"Adresse email"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fe,{size:16,className:"text-gray-500 mr-2"}),e.jsx("p",{className:"text-base dark:text-white",children:y})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"phone",children:"Numéro de téléphone"}),i?e.jsx("input",{id:"phone",type:"tel",value:p,onChange:A=>j(A.target.value),className:"tontine-input w-full",placeholder:"Numéro de téléphone"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ts,{size:16,className:"text-gray-500 mr-2"}),e.jsx("p",{className:"text-base dark:text-white",children:p})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"birthdate",children:"Date de naissance"}),i?e.jsx("input",{id:"birthdate",type:"text",value:v,onChange:A=>S(A.target.value),className:"tontine-input w-full",placeholder:"Date de naissance"}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ut,{size:16,className:"text-gray-500 mr-2"}),e.jsx("p",{className:"text-base dark:text-white",children:v})]})]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Préférences"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Cs,{size:18,className:"text-gray-500"}),e.jsx(K,{htmlFor:"notifications",children:"Notifications"})]}),e.jsx(Re,{id:"notifications",checked:N,onCheckedChange:U})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ze,{size:18,className:"text-gray-500"}),e.jsx(K,{htmlFor:"darkMode",children:"Mode sombre"})]}),e.jsx(Re,{id:"darkMode",checked:d,onCheckedChange:f})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_r,{size:18,className:"text-gray-500"}),e.jsx(K,{htmlFor:"language",children:"Langue"})]}),e.jsxs("select",{id:"language",value:P,onChange:A=>T(A.target.value),className:"tontine-select",children:[e.jsx("option",{value:"Français",children:"Français"}),e.jsx("option",{value:"English",children:"English"})]})]})]})]})})]})}),e.jsx(he,{value:"security",children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Sécurité du Compte"}),e.jsx(ye,{children:"Gérez les paramètres de sécurité de votre compte"})]}),e.jsx(te,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Mot de passe"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Votre mot de passe a été mis à jour pour la dernière fois il y a 3 mois"}),e.jsxs(H,{variant:"outline",onClick:q,children:[e.jsx(lt,{size:16,className:"mr-2"}),"Changer le mot de passe"]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Authentification à deux facteurs"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ajoutez une couche de sécurité supplémentaire à votre compte"})]}),e.jsx(Re,{checked:b,onCheckedChange:I})]}),b&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(As,{size:20,className:"text-green-600 dark:text-green-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-green-800 dark:text-green-400",children:"Authentification à deux facteurs activée"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-500 mt-1",children:"Votre compte est maintenant mieux protégé contre les accès non autorisés."})]})]})})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium dark:text-white",children:"Sessions actives"}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-white",children:"Cet appareil"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Paris, France • Dernière activité: Aujourd'hui"})]}),e.jsx("div",{className:"text-green-600 dark:text-green-400 text-sm font-medium",children:"Actif"})]})})]})]})})]})}),e.jsx(he,{value:"payments",children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ne,{children:"Moyens de Paiement"}),e.jsxs(H,{variant:"outline",size:"sm",children:[e.jsx(Ye,{size:16,className:"mr-2"}),"Ajouter"]})]}),e.jsx(ye,{children:"Gérez vos moyens de paiement pour les contributions"})]}),e.jsx(te,{children:e.jsx("div",{className:"space-y-4",children:Z.map(A=>e.jsxs("div",{className:"flex justify-between items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mr-4",children:A.type==="card"?e.jsx(Ye,{size:20,className:"text-tontine-dark-purple"}):e.jsx(Pr,{size:20,className:"text-tontine-dark-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-white",children:A.type==="card"?e.jsxs(e.Fragment,{children:["Carte •••• ",A.last4]}):e.jsx(e.Fragment,{children:A.name})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:A.type==="card"?e.jsxs(e.Fragment,{children:["Expire: ",A.expiry]}):e.jsxs(e.Fragment,{children:["Compte: ",A.accountNumber]})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[A.default&&e.jsx("span",{className:"text-xs bg-tontine-light-purple/20 text-tontine-dark-purple dark:bg-tontine-purple/30 dark:text-tontine-light-purple px-2 py-1 rounded-full",children:"Par défaut"}),e.jsx(H,{variant:"ghost",size:"sm",children:e.jsx(_e,{size:16})})]})]},A.id))})})]})}),e.jsx(he,{value:"history",children:e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Historique des Transactions"}),e.jsx(ye,{children:"Consultez l'historique de vos contributions et paiements"})]}),e.jsx(te,{children:e.jsx("div",{className:"space-y-4",children:k.map(A=>e.jsxs("div",{className:"flex justify-between items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mr-4 ${A.type==="contribution"?"bg-blue-100 dark:bg-blue-900/20":"bg-green-100 dark:bg-green-900/20"}`,children:A.type==="contribution"?e.jsx(Dr,{size:20,className:"text-blue-600 dark:text-blue-400"}):e.jsx(Ir,{size:20,className:"text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-white",children:A.type==="contribution"?"Contribution":"Paiement reçu"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[A.group," • ",A.date]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-semibold ${A.type==="contribution"?"text-blue-600 dark:text-blue-400":"text-green-600 dark:text-green-400"}`,children:[A.type==="contribution"?"-":"+",a(A.amount)]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:A.status==="completed"?"Complété":"En attente"})]})]},A.id))})})]})})]})})]})]})]})},_r=t=>e.jsxs("svg",{...t,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}),Pr=t=>e.jsxs("svg",{...t,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),e.jsx("path",{d:"M9 22v-4h6v4"}),e.jsx("path",{d:"M8 6h.01"}),e.jsx("path",{d:"M16 6h.01"}),e.jsx("path",{d:"M12 6h.01"}),e.jsx("path",{d:"M12 10h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 10h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 10h.01"}),e.jsx("path",{d:"M8 14h.01"})]}),Dr=t=>e.jsxs("svg",{...t,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m16 12-4-4-4 4"}),e.jsx("path",{d:"M12 16V8"})]}),Ir=t=>e.jsxs("svg",{...t,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"m8 12 4 4 4-4"}),e.jsx("path",{d:"M12 8v8"})]}),Mr=()=>{const{t}=L();return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-6xl font-bold tontine-text-gradient mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-6",children:t("pageNotFound")}),e.jsx(R,{to:"/",className:"tontine-button tontine-button-primary inline-block",children:t("returnToDashboard")})]})})},ue="https://api.tontine.example.com",Rr=15e3;class rt extends Error{constructor(r,a,n){super(r);Q(this,"status");Q(this,"data");this.name="ApiError",this.status=a,this.data=n}}const me=t=>{const s={"Content-Type":"application/json",Accept:"application/json"};return t&&(s.Authorization=`Bearer ${t}`),s},pe=async(t,s,r=Rr)=>{const a=new AbortController,{signal:n}=a,i=setTimeout(()=>a.abort(),r);try{const o=await fetch(t,{...s,signal:n});return clearTimeout(i),o}catch(o){throw clearTimeout(i),o instanceof Error&&o.name==="AbortError"?new rt("Request timeout",408):o}},xe=async t=>{const s=t.headers.get("content-type"),r=s&&s.includes("application/json"),a=r?await t.json():await t.text();if(t.ok)return{data:a,status:t.status,message:"success"};const n=r&&a.message?a.message:"Une erreur est survenue";throw new rt(n,t.status,a)},at={async get(t,s){const r=`${ue}${t}`,a={method:"GET",headers:me(s)},n=await pe(r,a);return xe(n)},async post(t,s,r){const a=`${ue}${t}`,n={method:"POST",headers:me(r),body:JSON.stringify(s)},i=await pe(a,n);return xe(i)},async put(t,s,r){const a=`${ue}${t}`,n={method:"PUT",headers:me(r),body:JSON.stringify(s)},i=await pe(a,n);return xe(i)},async patch(t,s,r){const a=`${ue}${t}`,n={method:"PATCH",headers:me(r),body:JSON.stringify(s)},i=await pe(a,n);return xe(i)},async delete(t,s){const r=`${ue}${t}`,a={method:"DELETE",headers:me(s)},n=await pe(r,a);return xe(n)}};var ts=(t=>(t.ADMIN="admin",t.MANAGER="manager",t.USER="user",t.GUEST="guest",t))(ts||{}),ie=(t=>(t.EMAIL="email",t.GOOGLE="google",t.FACEBOOK="facebook",t.TWITTER="twitter",t.APPLE="apple",t))(ie||{}),ss=(t=>(t.READ_USERS="read:users",t.WRITE_USERS="write:users",t.DELETE_USERS="delete:users",t.CREATE_TONTINE="create:tontine",t.READ_TONTINE="read:tontine",t.UPDATE_TONTINE="update:tontine",t.DELETE_TONTINE="delete:tontine",t.MANAGE_MEMBERS="manage:members",t.READ_PAYMENTS="read:payments",t.MAKE_PAYMENT="make:payment",t.APPROVE_PAYMENT="approve:payment",t.MANAGE_SETTINGS="manage:settings",t.VIEW_REPORTS="view:reports",t.EXPORT_DATA="export:data",t))(ss||{});const se="tontine_auth_token",Ne="tontine_refresh_token",ke="tontine_user",Ee="tontine_token_expiry",Te=(t,s,r,a,n)=>{const i=a?localStorage:sessionStorage;i.setItem(se,t),i.setItem(ke,JSON.stringify(s)),i.setItem(Ee,r.toString()),n&&i.setItem(Ne,n)},We=()=>{localStorage.removeItem(se),localStorage.removeItem(Ne),localStorage.removeItem(ke),localStorage.removeItem(Ee),sessionStorage.removeItem(se),sessionStorage.removeItem(Ne),sessionStorage.removeItem(ke),sessionStorage.removeItem(Ee)},W=()=>{let t=sessionStorage.getItem(se)||localStorage.getItem(se),s=sessionStorage.getItem(Ne)||localStorage.getItem(Ne),r=sessionStorage.getItem(ke)||localStorage.getItem(ke),a=sessionStorage.getItem(Ee)||localStorage.getItem(Ee);const n=r?JSON.parse(r):null,i=a?parseInt(a,10):null;return{token:t,refreshToken:s,user:n,expiresAt:i}},rs=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),Or=t=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(t),le=[{id:"user_1",email:"test@example.com",name:"Test User",role:"user",permissions:["read:tontine","create:tontine","make:payment"],createdAt:new Date().toISOString(),provider:"email"},{id:"admin_1",email:"admin@example.com",name:"Admin User",role:"admin",permissions:["read:users","write:users","delete:users","manage:settings","view:reports","export:data"],createdAt:new Date().toISOString(),provider:"email"}],zr=async(t,s=!1)=>{await new Promise(a=>setTimeout(a,500));const r=le.find(a=>a.email===t.email);if(r){const a={user:r,token:`mock_token_${Math.random().toString(36).substring(2,15)}`,expiresAt:Date.now()+36e5,refreshToken:`mock_refresh_token_${Math.random().toString(36).substring(2,15)}`};return Te(a.token,a.user,a.expiresAt,s,a.refreshToken),a}else throw new Error("Identifiants invalides")},Ur=async t=>{if(await new Promise(n=>setTimeout(n,500)),le.find(n=>n.email===t.email))throw new Error("Cet email est déjà utilisé");const r={id:`user_${Math.random().toString(36).substring(2,9)}`,email:t.email,name:t.fullName,role:"user",permissions:["read:tontine","create:tontine","make:payment"],createdAt:new Date().toISOString(),provider:"email"};le.push(r);const a={user:r,token:`mock_token_${Math.random().toString(36).substring(2,15)}`,expiresAt:Date.now()+36e5,refreshToken:`mock_refresh_token_${Math.random().toString(36).substring(2,15)}`};return Te(a.token,a.user,a.expiresAt,!1,a.refreshToken),a},Fr=async(t,s)=>{await new Promise(i=>setTimeout(i,500));let r={};switch(t){case"google":r={email:`google_user_${Math.random().toString(36).substring(2,9)}@gmail.com`,name:`Google User ${Math.floor(Math.random()*1e3)}`,profileImage:"https://via.placeholder.com/150"};break;case"facebook":r={email:`fb_user_${Math.random().toString(36).substring(2,9)}@facebook.com`,name:`Facebook User ${Math.floor(Math.random()*1e3)}`,profileImage:"https://via.placeholder.com/150"};break;case"twitter":r={email:`twitter_user_${Math.random().toString(36).substring(2,9)}@twitter.com`,name:`Twitter User ${Math.floor(Math.random()*1e3)}`,profileImage:"https://via.placeholder.com/150"};break;case"apple":r={email:`apple_user_${Math.random().toString(36).substring(2,9)}@icloud.com`,name:`Apple User ${Math.floor(Math.random()*1e3)}`,profileImage:"https://via.placeholder.com/150"};break;default:throw new Error("Fournisseur d'authentification non pris en charge")}let a=le.find(i=>i.email===r.email);a||(a={id:`user_${Math.random().toString(36).substring(2,9)}`,email:r.email,name:r.name,role:"user",permissions:["read:tontine","create:tontine","make:payment"],createdAt:new Date().toISOString(),profileImage:r.profileImage,provider:t},le.push(a));const n={user:a,token:`mock_token_${Math.random().toString(36).substring(2,15)}`,expiresAt:Date.now()+36e5,refreshToken:`mock_refresh_token_${Math.random().toString(36).substring(2,15)}`};return Te(n.token,n.user,n.expiresAt,!0,n.refreshToken),n},Gr=async()=>{const{token:t,refreshToken:s}=W();if(t)try{await at.post("/auth/logout",{refreshToken:s},t)}catch(r){console.error("Erreur lors de la déconnexion côté serveur:",r)}We()},Qe=[],Lr=async t=>{if(await new Promise(i=>setTimeout(i,500)),!rs(t))throw new Error("Adresse email invalide");if(!le.find(i=>i.email===t))throw new Error("Aucun compte trouvé avec cet email");const r=`reset_token_${Math.random().toString(36).substring(2,15)}`,a={email:t,token:r,createdAt:Date.now(),expiresAt:Date.now()+36e5},n=Qe.findIndex(i=>i.email===t);n!==-1?Qe[n]=a:Qe.push(a),console.log(`Email de réinitialisation envoyé à ${t}`),console.log(`Lien de réinitialisation : /reset-password?token=${r}`)},qr=async t=>{try{const s=await at.post("/auth/refresh-token",{refreshToken:t}),r=localStorage.getItem(se)!==null;return Te(s.data.token,s.data.user,s.data.expiresAt,r,s.data.refreshToken),s.data}catch{throw We(),new Error("Session expirée. Veuillez vous reconnecter.")}},$r=async(t,s)=>{try{const r=await at.patch("/users/profile",t,s),{expiresAt:a,refreshToken:n}=W(),i=r.data.user;if(a){const o=localStorage.getItem(se)!==null;Te(s,i,a,o,n||void 0)}return i}catch(r){throw r instanceof rt&&r.status===401?(We(),new Error("Session expirée. Veuillez vous reconnecter.")):new Error("Erreur lors de la mise à jour du profil")}},Vr=()=>{const{token:t,expiresAt:s}=W();return!t||!s?!1:s>Date.now()},Br=t=>{const{user:s}=W();return s?s.role===t:!1},Wr=t=>{const{user:s}=W();return!s||!s.permissions?!1:s.permissions.includes(t)},Hr=t=>{const{user:s}=W();return!s||!s.permissions?!1:t.every(r=>s.permissions.includes(r))},Kr=t=>{const{user:s}=W();return!s||!s.permissions?!1:t.some(r=>s.permissions.includes(r))},Yr=()=>{const{user:t}=W();return!t||!t.permissions?[]:t.permissions},Xr={login:zr,signup:Ur,socialLogin:Fr,logout:Gr,resetPassword:Lr,refreshToken:qr,updateUserProfile:$r,isAuthenticated:Vr,hasRole:Br,hasPermission:Wr,hasAllPermissions:Hr,hasAnyPermission:Kr,getUserPermissions:Yr,getAuthData:W,clearAuthData:We,isValidEmail:rs,isStrongPassword:Or,UserRole:ts,Permission:ss,AuthProvider:ie},as=({onSuccess:t,className:s=""})=>{const{loginWithProvider:r,loading:a}=J(),n=ce(),{toast:i}=Se(),o=async g=>{try{await r(g),t?t():n("/dashboard")}catch(u){console.error("Social login error:",u),i({title:"Login Failed",description:"An error occurred during social login. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:`space-y-3 ${s}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-gray-300 dark:border-gray-600"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400",children:"Ou continuer avec"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>o(ie.GOOGLE),disabled:a,className:"flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("svg",{className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]}),e.jsxs("button",{type:"button",onClick:()=>o(ie.FACEBOOK),disabled:a,className:"flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("svg",{className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{width:"24",height:"24",rx:"12",fill:"#1877F2"}),e.jsx("path",{d:"M16.6711 15.4688L17.2031 12H13.875V9.75C13.875 8.8008 14.3391 7.875 15.8297 7.875H17.3438V4.9219C17.3438 4.9219 15.9703 4.6875 14.6578 4.6875C11.9156 4.6875 10.125 6.3516 10.125 9.3516V12H7.07812V15.4688H10.125V23.8547C10.7367 23.9508 11.3625 24 12 24C12.6375 24 13.2633 23.9508 13.875 23.8547V15.4688H16.6711Z",fill:"white"})]}),"Facebook"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>o(ie.TWITTER),disabled:a,className:"flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx("svg",{className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M22 5.89c-.75.33-1.5.56-2.34.67.84-.5 1.5-1.3 1.8-2.24-.8.47-1.68.8-2.6 1a4.1 4.1 0 00-7 3.73c-3.4-.17-6.4-1.8-8.4-4.28a4.1 4.1 0 001.26 5.47c-.67-.02-1.3-.2-1.86-.5v.05a4.1 4.1 0 003.3 4.03 4.1 4.1 0 01-1.86.07 4.1 4.1 0 003.83 2.85A8.23 8.23 0 012 18.43a11.67 11.67 0 006.29 1.84c7.55 0 11.67-6.25 11.67-11.67 0-.18 0-.36-.02-.53.8-.58 1.5-1.3 2.05-2.12l.01-.06z",fill:"#1DA1F2"})}),"Twitter"]}),e.jsxs("button",{type:"button",onClick:()=>o(ie.APPLE),disabled:a,className:"flex justify-center items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsxs("svg",{className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M17.0349 12.5664C17.0176 10.5576 18.5018 9.5252 18.5704 9.4819C17.5379 7.9977 15.9348 7.8341 15.3602 7.8168C14.0428 7.6878 12.7772 8.6339 12.1162 8.6339C11.4379 8.6339 10.4055 7.8341 9.2936 7.8514C7.8471 7.8687 6.5124 8.6685 5.7817 9.9686C4.2802 12.5837 5.4094 16.4294 6.8559 18.4036C7.5861 19.3671 8.4378 20.4513 9.5497 20.4167C10.6271 20.3821 11.0553 19.7211 12.3554 19.7211C13.6382 19.7211 14.0428 20.4167 15.1719 20.3994C16.3357 20.3821 17.0659 19.4186 17.7788 18.4382C18.6305 17.3194 18.9723 16.2179 18.9896 16.1746C18.9551 16.1573 17.0522 15.3748 17.0349 12.5664Z",fill:"black"}),e.jsx("path",{d:"M15.0357 6.4223C15.6447 5.6591 16.0493 4.6094 15.9376 3.5425C15.0532 3.5771 13.9344 4.1561 13.3081 4.9021C12.7508 5.5631 12.2535 6.6473 12.3825 7.6797C13.3773 7.7489 14.4096 7.1699 15.0357 6.4223Z",fill:"black"})]}),"Apple"]})]})]})};function Jr(){const[t,s]=c.useState(""),[r,a]=c.useState(""),[n,i]=c.useState(!1),[o,g]=c.useState(!1),[u,y]=c.useState(!1),[p,j]=c.useState({}),{login:v}=J();L();const S=ce(),{toast:N}=Se(),U=()=>{const D={};let d=!0;return t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(D.email="Please enter a valid email address",d=!1):(D.email="Email is required",d=!1),r||(D.password="Password is required",d=!1),j(D),d},b=async D=>{if(D.preventDefault(),!!U()){y(!0);try{await v(t,r)&&(console.log("User signed in, navigating to dashboard"),S("/dashboard"))}catch(d){console.error("Sign in error:",d);let f="Login Failed",P="Invalid email or password. Please try again.";d.message&&(d.message.includes("429")||d.message.includes("Too Many Requests")?(f="Too Many Attempts",P="You've made too many sign-in attempts. Please wait a few minutes before trying again."):d.message.includes("network")||d.message.includes("connection")?(f="Network Error",P="Please check your internet connection and try again."):d.message.includes("Invalid credentials")||d.message.includes("Identifiants invalides")),N({title:f,description:P,variant:"destructive"})}finally{y(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx(R,{to:"/",className:"text-4xl font-bold tontine-text-gradient mb-4 block text-center cursor-pointer hover:opacity-80 transition-opacity",children:"Tontine"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Sign in to manage your tontine groups"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-8",children:[e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ft,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"email",type:"email",value:t,onChange:D=>{s(D.target.value),p.email&&j({...p,email:void 0})},className:`tontine-input pl-10 w-full ${p.email?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"you@example.com",required:!0})]}),p.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"password",type:n?"text":"password",value:r,onChange:D=>{a(D.target.value),p.password&&j({...p,password:void 0})},className:`tontine-input pl-10 w-full ${p.password?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>i(!n),children:n?e.jsx(ve,{size:18,className:"text-gray-400"}):e.jsx(je,{size:18,className:"text-gray-400"})})]}),p.password&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.password}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",checked:o,onChange:D=>g(D.target.checked),className:"h-4 w-4 text-tontine-purple focus:ring-tontine-purple border-gray-300 rounded"}),e.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Remember me"})]}),e.jsx(R,{to:"/forgot-password",className:"text-sm text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",children:"Forgot password?"})]})]}),e.jsx("button",{type:"submit",className:"tontine-button tontine-button-primary w-full",disabled:u,children:u?"Signing in...":"Sign In"})]}),e.jsx(as,{className:"mt-6"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Don't have an account?"," ",e.jsx(R,{to:"/signup",className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple font-medium",children:"Sign up"})]})})]})]})})}function Zr(){const[t,s]=c.useState(""),[r,a]=c.useState(""),[n,i]=c.useState(""),[o,g]=c.useState(""),[u,y]=c.useState(!1),[p,j]=c.useState(!1),[v,S]=c.useState(!1),[N,U]=c.useState({}),{signup:b}=J();L();const D=ce(),{toast:d}=Se(),f=()=>{const C={};let E=!0;return(!o||o.trim().length<2)&&(C.fullName="Please enter your full name (at least 2 characters)",E=!1),t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(C.email="Please enter a valid email address",E=!1):(C.email="Email is required",E=!1),r?r.length<8?(C.password="Password must be at least 8 characters",E=!1):/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(r)||(C.password="Password must include uppercase, lowercase, and numbers",E=!1):(C.password="Password is required",E=!1),r!==n&&(C.confirmPassword="Passwords do not match",E=!1),U(C),E},P=async C=>{if(C.preventDefault(),!!f())try{S(!0),await b(t,r,o)&&D("/dashboard")}catch(E){console.error("Sign up error:",E);let q="Sign Up Failed",I="An error occurred during sign up. Please try again.";E.message&&E.message.includes("429")?(q="Too Many Attempts",I="You've made too many sign-up attempts. Please wait a few minutes before trying again."):E.message&&(E.message.includes("profil")||E.message.includes("Profile creation failed"))?(q="Account Partially Created",I="Your account was created, but we couldn't set up your profile completely. Some features may be limited. Please try signing in.",setTimeout(()=>{D("/signin")},3e3)):E.message&&(E.message.includes("base de données")||E.message.includes("Database error"))?(q="Server Error",I="We're experiencing temporary server issues. Please try again in a few moments."):E.message&&(E.message.includes("email already in use")||E.message.includes("already exists")?(q="Email Already Registered",I="This email address is already registered. Please use a different email or try signing in."):E.message.includes("network")||E.message.includes("connection")?(q="Network Error",I="Please check your internet connection and try again."):(E.message.includes("Invalid email")||E.message.includes("mot de passe"))&&(q="Invalid Input",I="Please check your email and password and try again.")),d({title:q,description:I,variant:"destructive",icon:e.jsx(et,{className:"text-white"})})}finally{S(!1)}},k=(()=>{if(!r)return{strength:0,label:""};let C=0,E="Very weak";return r.length>=8&&(C+=1),r.length>=12&&(C+=1),/[A-Z]/.test(r)&&(C+=1),/[a-z]/.test(r)&&(C+=1),/[0-9]/.test(r)&&(C+=1),/[^A-Za-z0-9]/.test(r)&&(C+=1),C>=6?E="Very strong":C>=4?E="Strong":C>=3?E="Medium":C>=2&&(E="Weak"),{strength:Math.min(C,6),label:E,color:C<=2?"bg-red-500":C<=3?"bg-yellow-500":"bg-green-500"}})(),Z=k.strength/6*100;return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx(R,{to:"/",className:"text-4xl font-bold tontine-text-gradient mb-4 block text-center cursor-pointer hover:opacity-80 transition-opacity",children:"Tontine"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create your account to get started"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-8",children:[e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ft,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"fullName",type:"text",value:o,onChange:C=>{g(C.target.value),N.fullName&&U({...N,fullName:void 0})},className:`tontine-input pl-10 w-full ${N.fullName?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"John Doe",required:!0})]}),N.fullName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.fullName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Fe,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"email",type:"email",value:t,onChange:C=>{s(C.target.value),N.email&&U({...N,email:void 0})},className:`tontine-input pl-10 w-full ${N.email?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"you@example.com",required:!0})]}),N.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"password",type:u?"text":"password",value:r,onChange:C=>{a(C.target.value),N.password&&U({...N,password:void 0})},className:`tontine-input pl-10 w-full ${N.password?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>y(!u),children:u?e.jsx(ve,{size:18,className:"text-gray-400"}):e.jsx(je,{size:18,className:"text-gray-400"})})]}),r&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("div",{className:"h-2 w-full bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${k.color}`,style:{width:`${Z}%`}})}),e.jsx("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400 min-w-[80px] text-right",children:k.label})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Password must be at least 8 characters with uppercase, lowercase, and numbers"})]}),N.password&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"confirmPassword",type:p?"text":"password",value:n,onChange:C=>{i(C.target.value),N.confirmPassword&&U({...N,confirmPassword:void 0})},className:`tontine-input pl-10 w-full ${N.confirmPassword?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>j(!p),children:p?e.jsx(ve,{size:18,className:"text-gray-400"}):e.jsx(je,{size:18,className:"text-gray-400"})})]}),N.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N.confirmPassword})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"terms",type:"checkbox",required:!0,className:"h-4 w-4 text-tontine-purple focus:ring-tontine-purple border-gray-300 rounded"})}),e.jsx("div",{className:"ml-3 text-sm",children:e.jsxs("label",{htmlFor:"terms",className:"text-gray-600 dark:text-gray-400",children:["I agree to the ",e.jsx(R,{to:"/terms",className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",children:"Terms of Service"})," and ",e.jsx(R,{to:"/privacy",className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",children:"Privacy Policy"})]})})]}),e.jsx("button",{type:"submit",className:"tontine-button tontine-button-primary w-full",disabled:v,children:v?"Creating Account...":"Create Account"})]}),e.jsx(as,{className:"mt-6"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Already have an account?"," ",e.jsx(R,{to:"/signin",className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple font-medium",children:"Sign in"})]})})]})]})})}function Qr(){const[t,s]=c.useState(""),[r,a]=c.useState(""),[n,i]=c.useState(""),[o,g]=c.useState(!1),[u,y]=c.useState(!1),[p,j]=c.useState(null),[v,S]=c.useState(!1),[N,U]=c.useState(!1),{resetPassword:b}=J();L();const D=ce(),d=Gt(),{toast:f}=Se(),T=new URLSearchParams(d.search).get("token"),k=I=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(I),Z=I=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(I),C=async I=>{if(I.preventDefault(),j(null),!k(t)){j("Veuillez entrer une adresse email valide");return}try{g(!0),await b(t),y(!0),f({title:"Réinitialisation en cours",description:"Un lien de réinitialisation a été envoyé à votre email"})}catch(F){console.error("Erreur de réinitialisation:",F),j(F instanceof Error?F.message:"Une erreur est survenue")}finally{g(!1)}},E=async I=>{if(I.preventDefault(),j(null),r!==n){j("Les mots de passe ne correspondent pas");return}if(!Z(r)){j("Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre");return}try{if(g(!0),!T)throw new Error("Token de réinitialisation manquant");await Xr.confirmPasswordReset(T,r),f({title:"Mot de passe réinitialisé",description:"Votre mot de passe a été mis à jour avec succès"}),D("/signin")}catch(F){console.error("Erreur de réinitialisation:",F),j(F instanceof Error?F.message:"Une erreur est survenue")}finally{g(!1)}},q=()=>{y(!1),j(null)};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsx(R,{to:"/",className:"text-4xl font-bold tontine-text-gradient mb-4 block text-center cursor-pointer hover:opacity-80 transition-opacity",children:"Tontine"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:T?"Réinitialiser votre mot de passe":"Réinitialisation du mot de passe"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-8",children:[!T&&!u&&e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Entrez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Fe,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"email",type:"email",value:t,onChange:I=>{s(I.target.value),p&&j(null)},className:`tontine-input pl-10 w-full ${p?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"you@example.com",required:!0})]}),p&&e.jsxs("div",{className:"mt-2 flex items-center text-sm text-red-500",children:[e.jsx(et,{size:16,className:"mr-1"}),e.jsx("span",{children:p})]})]}),e.jsx("button",{type:"submit",className:"tontine-button tontine-button-primary w-full",disabled:o,children:o?"Envoi en cours...":"Envoyer le lien de réinitialisation"})]}),!T&&u&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"bg-tontine-light-purple/20 text-tontine-dark-purple dark:bg-tontine-purple/20 dark:text-tontine-light-purple p-3 rounded-full inline-flex items-center justify-center mb-4",children:e.jsx(Fe,{size:24})}),e.jsx("h3",{className:"text-xl font-semibold mb-2 dark:text-white",children:"Vérifiez votre email"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Nous avons envoyé un lien de réinitialisation à ",e.jsx("span",{className:"font-medium",children:t})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Vous n'avez pas reçu l'email ? Vérifiez votre dossier spam ou"," ",e.jsx("button",{onClick:q,className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",children:"réessayez"})]})]}),T&&e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Entrez un nouveau mot de passe pour votre compte."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"password",type:v?"text":"password",value:r,onChange:I=>{a(I.target.value),p&&j(null)},className:`tontine-input pl-10 w-full ${p?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"Nouveau mot de passe",required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>S(!v),children:v?e.jsx(ve,{size:18,className:"text-gray-400"}):e.jsx(je,{size:18,className:"text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 dark:text-gray-400",children:"Le mot de passe doit contenir au moins 8 caractères, une majuscule, une minuscule et un chiffre"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirmer le nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(we,{size:18,className:"text-gray-400"})}),e.jsx("input",{id:"confirmPassword",type:N?"text":"password",value:n,onChange:I=>{i(I.target.value),p&&j(null)},className:`tontine-input pl-10 w-full ${p?"border-red-500 focus:ring-red-500 focus:border-red-500":""}`,placeholder:"Confirmer le mot de passe",required:!0}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>U(!N),children:N?e.jsx(ve,{size:18,className:"text-gray-400"}):e.jsx(je,{size:18,className:"text-gray-400"})})]})]}),p&&e.jsxs("div",{className:"mt-2 flex items-center text-sm text-red-500",children:[e.jsx(et,{size:16,className:"mr-1"}),e.jsx("span",{children:p})]}),e.jsx("button",{type:"submit",className:"tontine-button tontine-button-primary w-full",disabled:o,children:o?"Réinitialisation en cours...":"Réinitialiser le mot de passe"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(R,{to:"/signin",className:"text-sm text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple",children:"Retour à la connexion"})})]})]})})}const ea=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 animate-fade-in",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24",children:e.jsxs("div",{className:"lg:grid lg:grid-cols-2 lg:gap-16 flex flex-col items-center",children:[e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6 text-center lg:text-left",children:"Tontine Digitale"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400 mb-8 text-center lg:text-left",children:"Gérez vos tontines facilement, en toute sécurité et transparence. Connectez-vous avec votre communauté et atteignez vos objectifs financiers."}),e.jsxs("div",{className:"flex justify-center lg:justify-start space-x-4",children:[e.jsxs(R,{to:"/signin",className:"tontine-button tontine-button-primary inline-flex items-center",children:[e.jsx(Pe,{size:18,className:"mr-2"}),"Commencer"]}),e.jsxs(R,{to:"/signup",className:"tontine-button tontine-button-secondary inline-flex items-center",children:[e.jsx(Y,{size:18,className:"mr-2"}),"Créer un Groupe"]})]})]}),e.jsxs("div",{className:"mt-12 lg:mt-0 grid grid-cols-2 gap-4",children:[e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-tontine-light-purple/50 flex items-center justify-center mr-4",children:e.jsx(oe,{size:20,className:"text-tontine-dark-purple"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Contributions"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"Facile"})]})]})}),e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-tontine-soft-blue/50 flex items-center justify-center mr-4",children:e.jsx(Lt,{size:20,className:"text-tontine-dark-purple"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Suivi"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"Transparent"})]})]})}),e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100/50 flex items-center justify-center mr-4",children:e.jsx(Ge,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Épargne"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"Sécurisée"})]})]})}),e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100/50 flex items-center justify-center mr-4",children:e.jsx(Y,{size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Communauté"}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"Connectée"})]})]})})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 py-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Comment ça marche ?"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Notre plateforme simplifie la gestion de vos tontines"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-md text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-tontine-light-purple/20 rounded-full flex items-center justify-center",children:e.jsx(Pe,{size:32,className:"text-tontine-dark-purple"})})}),e.jsx("h3",{className:"text-xl font-semibold mb-3 dark:text-white",children:"Créez votre groupe"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Invitez vos amis, famille ou collègues et définissez vos règles de contribution."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-md text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-100/20 rounded-full flex items-center justify-center",children:e.jsx(oe,{size:32,className:"text-green-600"})})}),e.jsx("h3",{className:"text-xl font-semibold mb-3 dark:text-white",children:"Contribuez régulièrement"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Suivez vos contributions, recevez des rappels et gérez vos paiements facilement."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-6 rounded-lg shadow-md text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-purple-100/20 rounded-full flex items-center justify-center",children:e.jsx(_s,{size:32,className:"text-purple-600"})})}),e.jsx("h3",{className:"text-xl font-semibold mb-3 dark:text-white",children:"Atteignez vos objectifs"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Visualisez vos progrès, recevez des récompenses et célébrez vos succès ensemble."})]})]})]})}),e.jsx("div",{className:"bg-tontine-purple text-white py-16",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Commencez votre voyage financier aujourd'hui"}),e.jsx("p",{className:"text-lg mb-8 text-white/80",children:"Rejoignez des milliers de personnes qui transforment leur épargne avec notre plateforme."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs(R,{to:"/signin",className:"tontine-button tontine-button-secondary text-tontine-purple bg-white inline-flex items-center",children:[e.jsx(Pe,{size:18,className:"mr-2"}),"Connexion"]}),e.jsxs(R,{to:"/signup",className:"tontine-button tontine-button-primary bg-white text-tontine-purple inline-flex items-center",children:[e.jsx(Y,{size:18,className:"mr-2"}),"S'inscrire"]})]})]})})]});function ta({name:t,members:s,contribution:r,nextDue:a,onClick:n}){const{t:i}=L();return e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 cursor-pointer animate-fade-in",onClick:n,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold dark:text-white",children:t}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Y,{size:16,className:"text-tontine-dark-purple dark:text-tontine-light-purple"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:s})]})]}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-tontine-soft-blue dark:bg-blue-900/50 flex items-center justify-center mr-3",children:e.jsx(oe,{size:16,className:"text-tontine-dark-purple dark:text-tontine-light-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("contribution")}),e.jsx("p",{className:"font-medium dark:text-white",children:r})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-tontine-soft-green dark:bg-green-900/50 flex items-center justify-center mr-3",children:e.jsx(Ut,{size:16,className:"text-tontine-dark-purple dark:text-tontine-light-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("nextDue")}),e.jsx("p",{className:"font-medium dark:text-white",children:a})]})]})]})]})}function ht({title:t,amount:s,trend:r,icon:a}){return e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center mr-4 ${a==="contribution"?"bg-tontine-soft-blue dark:bg-blue-900/50":"bg-tontine-soft-green dark:bg-green-900/50"}`,children:a==="contribution"?e.jsx(Ps,{size:20,className:"text-tontine-dark-purple dark:text-tontine-light-purple"}):e.jsx(Ge,{size:20,className:"text-tontine-dark-purple dark:text-tontine-light-purple"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:s}),r&&e.jsx("p",{className:"text-xs text-green-600 dark:text-green-400",children:r})]})]})})}function sa({members:t,title:s}){const{t:r}=L(),a=n=>{switch(n){case"active":return r("active");case"pending":return r("pending");case"paid":return r("paid");default:return""}};return e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 h-full animate-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-semibold dark:text-white",children:s}),e.jsxs("span",{className:"text-xs px-2 py-1 bg-tontine-soft-blue dark:bg-blue-900/50 rounded-full text-tontine-dark-purple dark:text-tontine-light-purple",children:[t.length," ",r("members")]})]}),e.jsx("div",{className:"space-y-3",children:t.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 overflow-hidden",children:n.image?e.jsx("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"}):e.jsx(Ue,{size:16,className:"text-gray-500 dark:text-gray-400"})}),e.jsx("span",{className:"font-medium text-sm dark:text-white",children:n.name})]}),e.jsx("div",{children:e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-400":n.status==="pending"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-400":"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-400"}`,children:a(n.status)})})]},n.id))})]})}function ra({name:t,contribution:s,image:r}){return e.jsxs("div",{className:"flex flex-col items-center p-6 animate-fade-in",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-tontine-soft-blue flex items-center justify-center mb-4 overflow-hidden border-2 border-tontine-purple",children:r?e.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover"}):e.jsx(Ue,{size:40,className:"text-tontine-purple"})}),e.jsx("h2",{className:"text-xl font-semibold",children:t}),e.jsx("div",{className:"mt-1 px-3 py-1 bg-tontine-light-purple/30 rounded-full text-sm font-medium text-tontine-dark-purple",children:s})]})}const aa=[{id:1,name:"Family Savings",members:8,contribution:50,frequency:"monthly",nextDue:"Jun 15, 2023"},{id:2,name:"Friends Circle",members:5,contribution:100,frequency:"monthly",nextDue:"Jun 22, 2023"},{id:3,name:"Business Collective",members:12,contribution:200,frequency:"monthly",nextDue:"Jul 1, 2023"}],na=[{id:1,name:"Nia Johnson",status:"active"},{id:2,name:"Kwame Brown",status:"active"},{id:3,name:"Zainab Ali",status:"pending"},{id:4,name:"Tariq Hassan",status:"active"},{id:5,name:"Amara Okafor",status:"paid"}],ia=()=>{const[t,s]=c.useState(!1),[r,a]=c.useState(3),{t:n,formatAmount:i}=L(),o=u=>{console.log("Creating new group:",u),s(!1)},g=(u,y)=>`${i(u)} / ${n(y)}`;return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 animate-fade-in",children:[e.jsx(Be,{}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:n("welcome")}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:n("trackContributions")})]}),e.jsxs("div",{className:"mt-4 lg:mt-0 flex flex-wrap gap-2",children:[e.jsxs("button",{className:"tontine-button tontine-button-secondary inline-flex items-center",onClick:()=>a(0),children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{size:18,className:"mr-2"}),r>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",children:r})]}),n("payments")]}),e.jsxs("button",{className:"tontine-button tontine-button-primary inline-flex items-center",onClick:()=>s(!0),children:[e.jsx(Pe,{size:18,className:"mr-2"}),n("createNewGroup")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(ht,{title:n("totalContributions"),amount:i(1250),trend:"Up 8% from last month",icon:"contribution"}),e.jsx(ht,{title:n("availableBalance"),amount:i(450),icon:"balance"}),e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-tontine-light-purple/50 flex items-center justify-center mr-4",children:e.jsx(Y,{size:20,className:"text-tontine-dark-purple"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:n("activeGroups")}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"3"})]})]})}),e.jsx("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 animate-slide-up",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-tontine-soft-blue/50 flex items-center justify-center mr-4",children:e.jsx(Lt,{size:20,className:"text-tontine-dark-purple"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:n("nextPayout")}),e.jsx("p",{className:"text-2xl font-semibold dark:text-white",children:"Jun 30"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold dark:text-white",children:n("yourGroups")}),e.jsx("button",{className:"text-tontine-purple hover:text-tontine-dark-purple dark:text-tontine-light-purple dark:hover:text-tontine-purple text-sm font-medium",children:n("viewAll")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:aa.map(u=>e.jsx(ta,{name:u.name,members:u.members,contribution:g(u.contribution,u.frequency),nextDue:u.nextDue,onClick:()=>console.log("Clicked on group:",u.id)},u.id))}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 dark:text-white",children:n("paymentCalendar")}),e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700 p-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(u=>e.jsx("div",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 py-1",children:u},u))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Array.from({length:35}).map((u,y)=>{const p=y-3,j=p>0&&p<=30,v=[10,15,22].includes(p);return e.jsxs("div",{className:`
                          h-10 flex items-center justify-center rounded-md text-sm
                          ${j?"hover:bg-gray-100 dark:hover:bg-gray-700":"text-gray-400 dark:text-gray-600"} 
                          ${v?"bg-tontine-light-purple/20 dark:bg-tontine-purple/30":""}
                        `,children:[p>0?p:31+p,v&&e.jsx("span",{className:"w-1 h-1 bg-tontine-purple absolute bottom-1 rounded-full"})]},y)})})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700",children:[e.jsx(ra,{name:"Olivia Nkosi",contribution:"Premium Member"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(oe,{size:18,className:"text-tontine-dark-purple mr-1"}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:n("active")})]}),e.jsxs("p",{className:"font-semibold dark:text-white",children:["3 ",n("members")]})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx(Ge,{size:18,className:"text-tontine-dark-purple mr-1"}),e.jsx("span",{className:"text-sm font-medium dark:text-white",children:"Saved"})]}),e.jsx("p",{className:"font-semibold dark:text-white",children:i(3200)})]})]})]}),e.jsx(sa,{title:n("recentMembers"),members:na}),e.jsxs("div",{className:"tontine-card dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("h3",{className:"font-semibold mb-4 dark:text-white",children:n("recentActivity")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(oe,{size:16,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm dark:text-white",children:[n("receivedPayout")," ",e.jsx("span",{className:"font-medium",children:i(200)})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["2 ",n("hoursAgo")]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(Y,{size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm dark:text-white",children:[e.jsx("span",{className:"font-medium",children:"Zainab Ali"})," ",n("joinedGroup")," Family Savings"]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n("yesterday")})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(Ge,{size:16,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm dark:text-white",children:[n("madeContribution")," ",e.jsx("span",{className:"font-medium",children:i(50)})," to Family Savings"]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["2 ",n("daysAgo")]})]})]})]})]})]})]})]}),e.jsx(Xt,{isOpen:t,onClose:()=>s(!1),onSubmit:o})]})};function oa(){const[t,s]=c.useState([]),[r,a]=c.useState(!0),[n,i]=c.useState("");c.useEffect(()=>{o()},[]);async function o(){try{a(!0);const{data:p,error:j}=await m.from("todos").select("*");if(j)throw j;p&&s(p)}catch(p){console.error("Error fetching todos:",p)}finally{a(!1)}}async function g(){if(n.trim())try{const{data:p,error:j}=await m.from("todos").insert([{title:n,completed:!1}]).select();if(j)throw j;p&&(s([...t,...p]),i(""))}catch(p){console.error("Error adding todo:",p)}}async function u(p,j){try{const{error:v}=await m.from("todos").update({completed:!j}).eq("id",p);if(v)throw v;s(t.map(S=>S.id===p?{...S,completed:!j}:S))}catch(v){console.error("Error updating todo:",v)}}async function y(p){try{const{error:j}=await m.from("todos").delete().eq("id",p);if(j)throw j;s(t.filter(v=>v.id!==p))}catch(j){console.error("Error deleting todo:",j)}}return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(Be,{}),e.jsxs("main",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-8",children:"Supabase Todo Demo"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex mb-6",children:[e.jsx("input",{type:"text",value:n,onChange:p=>i(p.target.value),placeholder:"Add a new todo...",className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md focus:outline-none focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:text-white",onKeyPress:p=>{p.key==="Enter"&&g()}}),e.jsx("button",{onClick:g,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-r-md transition-colors",children:"Add"})]}),r?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):e.jsx("ul",{className:"space-y-2",children:t.length>0?t.map(p=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:p.completed,onChange:()=>u(p.id,p.completed),className:"h-5 w-5 text-purple-600 rounded focus:ring-purple-500 dark:bg-gray-600"}),e.jsx("span",{className:`ml-3 ${p.completed?"line-through text-gray-500 dark:text-gray-400":"text-gray-800 dark:text-white"}`,children:p.title})]}),e.jsx("button",{onClick:()=>y(p.id),className:"text-red-500 hover:text-red-700 transition-colors",children:"Delete"})]},p.id)):e.jsx("p",{className:"text-center py-4 text-gray-500 dark:text-gray-400",children:"No todos yet. Add one above!"})})]})]})]})}const yt=({redirectPath:t="/signin",requireAuth:s=!0})=>{const{isAuthenticated:r,loading:a,refreshSession:n}=J(),i=Gt();return c.useEffect(()=>{!a&&!r&&s&&n()},[a,r,s,n]),a?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-tontine-purple"})}):s&&!r?e.jsx(ct,{to:t,state:{from:i},replace:!0}):!s&&r?e.jsx(ct,{to:"/dashboard",replace:!0}):e.jsx(Ds,{})};class la extends Error{constructor(r,a,n){super(r);Q(this,"code");Q(this,"details");this.name="TontineServiceError",this.code=a,this.details=n}}const _=(t,s)=>{throw new la(s||(t==null?void 0:t.message)||"Une erreur est survenue",t==null?void 0:t.code,t==null?void 0:t.details)},ca=async t=>{const{data:s,error:r}=await m.from("tontine_groups").insert({...t,status:"pending",current_round:0,created_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de la création du groupe"),s},da=async t=>{const{data:s,error:r}=await m.from("tontine_groups").select(`
      *,
      group_members!inner(*)
    `).eq("group_members.user_id",t);return r&&_(r,"Erreur lors de la récupération des groupes"),s},ua=async t=>{const{data:s,error:r}=await m.from("tontine_groups").select("*").eq("id",t).single();return r&&_(r,"Erreur lors de la récupération des détails du groupe"),s},ma=async(t,s)=>{const{data:r,error:a}=await m.from("tontine_groups").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour du groupe"),r},pa=async t=>{const{error:s}=await m.from("tontine_groups").delete().eq("id",t);s&&_(s,"Erreur lors de la suppression du groupe")},ns=async t=>{const{data:s,error:r}=await m.from("group_members").insert({...t,joined_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de l'ajout du membre au groupe"),s},xa=async t=>{const{data:s,error:r}=await m.from("group_members").select(`
      *,
      profiles:user_id(id, full_name, avatar_url, email)
    `).eq("group_id",t);return r&&_(r,"Erreur lors de la récupération des membres du groupe"),s},ga=async(t,s)=>{const{data:r,error:a}=await m.from("group_members").update(s).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour du membre"),r},fa=async t=>{const{error:s}=await m.from("group_members").update({status:"removed"}).eq("id",t);s&&_(s,"Erreur lors de la suppression du membre")},ha=async(t,s,r="member")=>{const{data:a,error:n}=await m.from("profiles").select("id").eq("email",s).single();if(n&&n.code!=="PGRST116"&&_(n,"Erreur lors de la recherche de l'utilisateur"),a)return ns({group_id:t,user_id:a.id,role:r,status:"pending",invitation_email:s,invitation_status:"sent"});{const{data:i,error:o}=await m.from("group_members").insert({group_id:t,user_id:"00000000-0000-0000-0000-000000000000",role:r,status:"pending",joined_at:new Date().toISOString(),invitation_email:s,invitation_status:"sent"}).select().single();return o&&_(o,"Erreur lors de l'invitation de l'utilisateur"),i}},ya=async t=>{const{data:s,error:r}=await m.from("contributions").insert({...t,created_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de l'enregistrement de la contribution"),s},ba=async(t,s)=>{let r=m.from("contributions").select("*").eq("user_id",t);s&&(r=r.eq("group_id",s));const{data:a,error:n}=await r;return n&&_(n,"Erreur lors de la récupération des contributions"),a},wa=async(t,s)=>{let r=m.from("contributions").select(`
      *,
      profiles:user_id(id, full_name, avatar_url)
    `).eq("group_id",t);s!==void 0&&(r=r.eq("round_number",s));const{data:a,error:n}=await r;return n&&_(n,"Erreur lors de la récupération des contributions du groupe"),a},va=async(t,s)=>{const{data:r,error:a}=await m.from("contributions").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour de la contribution"),r},ja=async t=>{const{error:s}=await m.from("contributions").delete().eq("id",t);s&&_(s,"Erreur lors de la suppression de la contribution")},Na=async t=>{const{data:s,error:r}=await m.from("payouts").insert({...t,created_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de la programmation du paiement"),s},ka=async t=>{const{data:s,error:r}=await m.from("payouts").select("*").eq("user_id",t);return r&&_(r,"Erreur lors de la récupération des paiements"),s},Ea=async t=>{const{data:s,error:r}=await m.from("payouts").select(`
      *,
      profiles:user_id(id, full_name, avatar_url)
    `).eq("group_id",t);return r&&_(r,"Erreur lors de la récupération des paiements du groupe"),s},Sa=async(t,s)=>{const{data:r,error:a}=await m.from("payouts").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour du paiement"),r},Ta=async t=>{t.is_default&&await m.from("payment_methods").update({is_default:!1}).eq("user_id",t.user_id);const{data:s,error:r}=await m.from("payment_methods").insert({...t,created_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de l'ajout du moyen de paiement"),s},Ca=async t=>{const{data:s,error:r}=await m.from("payment_methods").select("*").eq("user_id",t).order("is_default",{ascending:!1});return r&&_(r,"Erreur lors de la récupération des moyens de paiement"),s},Aa=async(t,s)=>{if(s.is_default){const{data:n}=await m.from("payment_methods").select("user_id").eq("id",t).single();n&&await m.from("payment_methods").update({is_default:!1}).eq("user_id",n.user_id).neq("id",t)}const{data:r,error:a}=await m.from("payment_methods").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour du moyen de paiement"),r},_a=async t=>{const{error:s}=await m.from("payment_methods").delete().eq("id",t);s&&_(s,"Erreur lors de la suppression du moyen de paiement")},Pa=async t=>{const{data:s,error:r}=await m.from("notifications").select("*").eq("user_id",t).order("created_at",{ascending:!1});return r&&_(r,"Erreur lors de la récupération des notifications"),s},Da=async t=>{const{data:s,error:r}=await m.from("notifications").update({read:!0}).eq("id",t).select().single();return r&&_(r,"Erreur lors de la mise à jour de la notification"),s},Ia=async t=>{const{error:s}=await m.from("notifications").update({read:!0}).eq("user_id",t).eq("read",!1);s&&_(s,"Erreur lors de la mise à jour des notifications")},Ma=async t=>{const{error:s}=await m.from("notifications").delete().eq("id",t);s&&_(s,"Erreur lors de la suppression de la notification")},Ra=async t=>{const{data:s,error:r}=await m.from("transactions").select("*").eq("user_id",t).order("created_at",{ascending:!1});return r&&_(r,"Erreur lors de la récupération des transactions"),s},Oa=async t=>{const{data:s,error:r}=await m.from("transactions").insert({...t,created_at:new Date().toISOString()}).select().single();return r&&_(r,"Erreur lors de la création de la transaction"),s},za=async(t,s)=>{const{data:r,error:a}=await m.from("transactions").update({status:s,updated_at:new Date().toISOString()}).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour de la transaction"),r},Ua=async(t,s)=>{const{data:r,error:a}=await m.from("profiles").update(s).eq("id",t).select().single();return a&&_(a,"Erreur lors de la mise à jour du profil"),r},Fa=async t=>{const{data:s,error:r}=await m.from("profiles").select("*").eq("id",t).single();return r&&_(r,"Erreur lors de la récupération du profil"),s},O={createTontineGroup:ca,getUserGroups:da,getGroupDetails:ua,updateTontineGroup:ma,deleteTontineGroup:pa,addMemberToGroup:ns,getGroupMembers:xa,updateGroupMember:ga,removeMemberFromGroup:fa,inviteUserToGroup:ha,recordContribution:ya,getUserContributions:ba,getGroupContributions:wa,updateContribution:va,deleteContribution:ja,schedulePayout:Na,getUserPayouts:ka,getGroupPayouts:Ea,updatePayout:Sa,addPaymentMethod:Ta,getUserPaymentMethods:Ca,updatePaymentMethod:Aa,deletePaymentMethod:_a,getUserNotifications:Pa,markNotificationAsRead:Da,markAllNotificationsAsRead:Ia,deleteNotification:Ma,getUserTransactions:Ra,createTransaction:Oa,updateTransactionStatus:za,updateUserProfile:Ua,getUserProfile:Fa},Ga=c.createContext({userGroups:[],currentGroup:null,groupMembers:[],contributions:[],payouts:[],notifications:[],isLoading:{groups:!1,members:!1,contributions:!1,payouts:!1,notifications:!1},error:null,fetchUserGroups:async()=>{},fetchGroupDetails:async()=>{},createGroup:async()=>({id:"",name:"",contribution_amount:0,currency:"",frequency:"monthly",start_date:"",payout_method:"rotation",created_by:"",created_at:"",status:"pending"}),updateGroup:async()=>{},deleteGroup:async()=>{},fetchGroupMembers:async()=>{},addMember:async()=>{},updateMember:async()=>{},removeMember:async()=>{},inviteMember:async()=>{},fetchContributions:async()=>{},recordContribution:async()=>{},updateContribution:async()=>{},fetchPayouts:async()=>{},schedulePayout:async()=>{},updatePayout:async()=>{},fetchNotifications:async()=>{},markNotificationAsRead:async()=>{},markAllNotificationsAsRead:async()=>{},deleteNotification:async()=>{},clearCurrentGroup:()=>{},refreshData:async()=>{}}),La=({children:t})=>{const{user:s,isAuthenticated:r}=J(),[a,n]=c.useState([]),[i,o]=c.useState(null),[g,u]=c.useState([]),[y,p]=c.useState([]),[j,v]=c.useState([]),[S,N]=c.useState([]),[U,b]=c.useState({groups:!1,members:!1,contributions:!1,payouts:!1,notifications:!1}),[D,d]=c.useState(null),f=(x,l)=>{console.error(l,x);const w=x.message||l;d(w),setTimeout(()=>d(null),5e3)};c.useEffect(()=>{r&&s&&(P(),He())},[r,s]);const P=async()=>{if(s){b(x=>({...x,groups:!0})),d(null);try{const x=await O.getUserGroups(s.id);n(x)}catch(x){f(x,"Erreur lors de la récupération des groupes")}finally{b(x=>({...x,groups:!1}))}}},T=async x=>{b(l=>({...l,groups:!0})),d(null);try{const l=await O.getGroupDetails(x);o(l),E(x),de(x),nt(x)}catch(l){f(l,"Erreur lors de la récupération des détails du groupe")}finally{b(l=>({...l,groups:!1}))}},k=async x=>{if(!s)throw new Error("Utilisateur non authentifié");b(l=>({...l,groups:!0})),d(null);try{const l=await O.createTontineGroup(x);return await O.addMemberToGroup({group_id:l.id,user_id:s.id,role:"admin",status:"active"}),n(w=>[...w,l]),l}catch(l){throw f(l,"Erreur lors de la création du groupe"),l}finally{b(l=>({...l,groups:!1}))}},Z=async(x,l)=>{b(w=>({...w,groups:!0})),d(null);try{const w=await O.updateTontineGroup(x,l);i&&i.id===x&&o(w),n(z=>z.map($=>$.id===x?w:$))}catch(w){throw f(w,"Erreur lors de la mise à jour du groupe"),w}finally{b(w=>({...w,groups:!1}))}},C=async x=>{b(l=>({...l,groups:!0})),d(null);try{await O.deleteTontineGroup(x),n(l=>l.filter(w=>w.id!==x)),i&&i.id===x&&o(null)}catch(l){throw f(l,"Erreur lors de la suppression du groupe"),l}finally{b(l=>({...l,groups:!1}))}},E=async x=>{b(l=>({...l,members:!0})),d(null);try{const l=await O.getGroupMembers(x);u(l)}catch(l){f(l,"Erreur lors de la récupération des membres du groupe")}finally{b(l=>({...l,members:!1}))}},q=async x=>{b(l=>({...l,members:!0})),d(null);try{const l=await O.addMemberToGroup(x);u(w=>[...w,l])}catch(l){throw f(l,"Erreur lors de l'ajout du membre"),l}finally{b(l=>({...l,members:!1}))}},I=async(x,l)=>{b(w=>({...w,members:!0})),d(null);try{const w=await O.updateGroupMember(x,l);u(z=>z.map($=>$.id===x?w:$))}catch(w){throw f(w,"Erreur lors de la mise à jour du membre"),w}finally{b(w=>({...w,members:!1}))}},F=async x=>{b(l=>({...l,members:!0})),d(null);try{await O.removeMemberFromGroup(x),u(l=>l.filter(w=>w.id!==x))}catch(l){throw f(l,"Erreur lors de la suppression du membre"),l}finally{b(l=>({...l,members:!1}))}},Ce=async(x,l,w="member")=>{b(z=>({...z,members:!0})),d(null);try{const z=await O.inviteUserToGroup(x,l,w);u($=>[...$,z])}catch(z){throw f(z,"Erreur lors de l'invitation du membre"),z}finally{b(z=>({...z,members:!1}))}},de=async x=>{b(l=>({...l,contributions:!0})),d(null);try{const l=await O.getGroupContributions(x);p(l)}catch(l){f(l,"Erreur lors de la récupération des contributions")}finally{b(l=>({...l,contributions:!1}))}},Ae=async x=>{b(l=>({...l,contributions:!0})),d(null);try{const l=await O.recordContribution(x);p(w=>[...w,l])}catch(l){throw f(l,"Erreur lors de l'enregistrement de la contribution"),l}finally{b(l=>({...l,contributions:!1}))}},A=async(x,l)=>{b(w=>({...w,contributions:!0})),d(null);try{const w=await O.updateContribution(x,l);p(z=>z.map($=>$.id===x?w:$))}catch(w){throw f(w,"Erreur lors de la mise à jour de la contribution"),w}finally{b(w=>({...w,contributions:!1}))}},nt=async x=>{b(l=>({...l,payouts:!0})),d(null);try{const l=await O.getGroupPayouts(x);v(l)}catch(l){f(l,"Erreur lors de la récupération des paiements")}finally{b(l=>({...l,payouts:!1}))}},is=async x=>{b(l=>({...l,payouts:!0})),d(null);try{const l=await O.schedulePayout(x);v(w=>[...w,l])}catch(l){throw f(l,"Erreur lors de la programmation du paiement"),l}finally{b(l=>({...l,payouts:!1}))}},os=async(x,l)=>{b(w=>({...w,payouts:!0})),d(null);try{const w=await O.updatePayout(x,l);v(z=>z.map($=>$.id===x?w:$))}catch(w){throw f(w,"Erreur lors de la mise à jour du paiement"),w}finally{b(w=>({...w,payouts:!1}))}},He=async()=>{if(s){b(x=>({...x,notifications:!0})),d(null);try{const x=await O.getUserNotifications(s.id);N(x)}catch(x){f(x,"Erreur lors de la récupération des notifications")}finally{b(x=>({...x,notifications:!1}))}}},ls={userGroups:a,currentGroup:i,groupMembers:g,contributions:y,payouts:j,notifications:S,isLoading:U,error:D,fetchUserGroups:P,fetchGroupDetails:T,createGroup:k,updateGroup:Z,deleteGroup:C,fetchGroupMembers:E,addMember:q,updateMember:I,removeMember:F,inviteMember:Ce,fetchContributions:de,recordContribution:Ae,updateContribution:A,fetchPayouts:nt,schedulePayout:is,updatePayout:os,fetchNotifications:He,markNotificationAsRead:async x=>{b(l=>({...l,notifications:!0})),d(null);try{const l=await O.markNotificationAsRead(x);N(w=>w.map(z=>z.id===x?l:z))}catch(l){f(l,"Erreur lors de la mise à jour de la notification")}finally{b(l=>({...l,notifications:!1}))}},markAllNotificationsAsRead:async()=>{if(s){b(x=>({...x,notifications:!0})),d(null);try{await O.markAllNotificationsAsRead(s.id),N(x=>x.map(l=>({...l,read:!0})))}catch(x){f(x,"Erreur lors de la mise à jour des notifications")}finally{b(x=>({...x,notifications:!1}))}}},deleteNotification:async x=>{b(l=>({...l,notifications:!0})),d(null);try{await O.deleteNotification(x),N(l=>l.filter(w=>w.id!==x))}catch(l){f(l,"Erreur lors de la suppression de la notification")}finally{b(l=>({...l,notifications:!1}))}},clearCurrentGroup:()=>{o(null),u([]),p([]),v([])},refreshData:async x=>{s&&(await P(),await He(),x&&await T(x))}};return e.jsx(Ga.Provider,{value:ls,children:t})};async function qa(){try{const{error:t}=await m.from("profiles").select("id").limit(1);return t&&console.log("Profiles table may not exist or is not accessible. Assuming it exists for now."),!0}catch(t){return console.error("Error checking profiles table:",t),!0}}async function $a(){try{const t=await pt(re.SUPABASE),s=await pt(re.SQL_SERVER);console.log("Database availability:",{supabase:t,sqlServer:s}),t?(mt({primaryDatabase:re.SUPABASE,fallbackDatabase:s?re.SQL_SERVER:void 0,useFallback:s}),await qa()||console.warn("Could not ensure profiles table exists in Supabase. Some features may not work correctly.")):s?mt({primaryDatabase:re.SQL_SERVER,fallbackDatabase:void 0,useFallback:!1}):console.error("No database connections available. Application will run in limited mode.")}catch(t){console.error("Database initialization failed:",t)}}const Va=new Is,Ba=()=>(c.useEffect(()=>{$a().catch(t=>{console.warn("Database initialization failed, but app will continue:",t)})},[]),e.jsxs(Hs,{children:[e.jsx(Bs,{}),e.jsx(Ws,{}),e.jsx(Rs,{children:e.jsxs(Os,{children:[e.jsx(V,{path:"/",element:e.jsx(ea,{})}),e.jsxs(V,{element:e.jsx(yt,{requireAuth:!1}),children:[e.jsx(V,{path:"/signin",element:e.jsx(Jr,{})}),e.jsx(V,{path:"/signup",element:e.jsx(Zr,{})}),e.jsx(V,{path:"/forgot-password",element:e.jsx(Qr,{})})]}),e.jsxs(V,{element:e.jsx(yt,{}),children:[e.jsx(V,{path:"/dashboard",element:e.jsx(ia,{})}),e.jsx(V,{path:"/profile",element:e.jsx(Ar,{})}),e.jsx(V,{path:"/groups",element:e.jsx(kr,{})}),e.jsx(V,{path:"/supabase-demo",element:e.jsx(oa,{})})]}),e.jsx(V,{path:"*",element:e.jsx(Mr,{})})]})})]})),Wa=()=>e.jsx(Ms,{client:Va,children:e.jsx(Zs,{children:e.jsx(jr,{children:e.jsx(La,{children:e.jsx(Ba,{})})})})});async function Ha(){try{console.log("Initializing database..."),await Ka(),await Ya(),console.log("Database initialization complete")}catch(t){console.error("Error initializing database:",t)}}async function Ka(){try{const{error:t}=await m.rpc("create_profiles_table",{});if(t){console.warn("RPC table creation failed:",t);try{await m.query(`
          CREATE TABLE IF NOT EXISTS public.profiles (
            id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
            email TEXT NOT NULL,
            full_name TEXT,
            avatar_url TEXT,
            phone_number TEXT,
            preferred_language TEXT DEFAULT 'fr',
            notification_preferences JSONB DEFAULT '{"email": true, "push": true, "sms": false}'::jsonb,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
          );
          
          -- Set up Row Level Security (RLS)
          ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
          
          -- Create policies
          CREATE POLICY IF NOT EXISTS "Users can view their own profile"
            ON public.profiles
            FOR SELECT
            USING (auth.uid() = id);
          
          CREATE POLICY IF NOT EXISTS "Users can update their own profile"
            ON public.profiles
            FOR UPDATE
            USING (auth.uid() = id);
          
          CREATE POLICY IF NOT EXISTS "Users can insert their own profile"
            ON public.profiles
            FOR INSERT
            WITH CHECK (auth.uid() = id);
        `)}catch(s){throw console.error("Direct table creation failed:",s),s}}}catch(t){throw console.error("Error creating profiles table:",t),t}}async function Ya(){try{const{data:t,error:s}=await m.from("profiles").select("id").limit(1);if(s)if(console.warn("Error accessing profiles table:",s),s.code==="PGRST116"||s.message.includes('relation "profiles" does not exist')){console.log("Profiles table may not exist. Attempting to create a dummy record...");try{await m.from("profiles").insert([{id:"00000000-0000-0000-0000-000000000000",email:"system-init@example.com",full_name:"System Initialization User"}]),await m.from("profiles").delete().eq("id","00000000-0000-0000-0000-000000000000")}catch(r){throw console.error("Failed to create dummy profile:",r),r}}else throw s}catch(t){throw console.error("Critical error in verifyDatabaseAccess:",t),t}}Ha().catch(t=>{console.error("Failed to initialize database:",t)}).finally(()=>{zs(document.getElementById("root")).render(e.jsx(Wa,{}))});
